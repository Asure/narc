TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

                                                                     PAGE    1

       1                            .FILE   "NARCFLAM.ASM"
       3                            .WIDTH  132
       4                            .OPTION B,D,L
       5                            .MNOLIST        
       6                    
       7                    *       GET THE SYSTEM STUFF
       8                            .INCLUDE        "\video\MPROCEQU.ASM"   ;MPROC equates
       9                            .INCLUDE        "\video\DISPEQU.ASM"    ;Display processor equates
      10                            .INCLUDE        "\video\GSP.INC"        ;GSP assembler equates
      11                            .INCLUDE        "\video\SYS.INC"        ;Zunit system equates
      12                            .INCLUDE        "\video\MACROS.HDR"     ;Macros, Yeah!
      13                    *       LOCAL STUFF
      14                            .INCLUDE        "NARCEQU.ASM"           ;NARC Equates
      15                            .INCLUDE        "NARCTEQU.ASM"          ;TODD JIZZ
      16                            .INCLUDE        "IMGTBL.GLO"            ;Image Label Equates
      17                    
      18                            .GLOBL  MAKEFLAM,GROWFLAM
      19                    
      20 00000000     f310  FLAMESND        .WORD   0F310H,03H,080cfH,0 ;flame thrower snd
      21                    ;FLAMESND       .WORD   0F310H,03H,08094H,0 ;flame thrower snd
      22 00000040     f315  FRYSND          .WORD   0F315H,013H,08088H,0 ;burning sound
      23                    
      24              0ff5  FTHRWPID        .set    00FF5H
      25              0ff6  FLOUTPID        .set    00FF6H
      26          00120012  FLAMZSIZ        .set    000120012H
      27              0be1  FLAMEOID        .set    BEOID|FLAMEID
      28                    
      29              0002  ANIWAIT         .set    2       ;tiks between flame animations
      30                    
      31                    ;PROCESS BLOCK OFFSETS
      32              0180  HEADANIX        .set    ETEMP1
      33              0190  TAILANIX        .set    ETEMP1+16
      34              01a0  FLAMEDIR        .set    ETEMP2
      35              01a8  ANICTR          .set    ETEMP2+8
      36              01b0  STRTANIX        .set    ETEMP2+16
      37              01c0  FLAMEOUT        .set    ETEMP3
      38              01c8  GROWING         .set    ETEMP3+8
      39              01d0  FXOFF           .set    ETEMP3+16
      40              01e0  ANITIKS         .set    ETEMP4
      41              01e8  COLLTIKS        .set    ETEMP4+8
      42              01f0  FLAMTIKS        .set    ETEMP4+16
      43              01f8  SNDTIKS         .set    ETEMP4+24
      44              0200  BLAH3           .set    ETEMP5
      45              0220  BLAH2           .set    ETEMP6
      46              00e0  HEADANI         .set    ESWTCH
      47              0120  TAILANI         .set    EYXVEL
      48                    ;COLLOBJ        .set    EOBJ            from narctequ
      49              0100  FXVEL           .set    EMAINT
      50              0140  SHRNKSPD        .set    EBCNTRS         ;byte
      51              0148  GROWSPD         .set    EBCNTRS+8       ;byte
      52              0150  FLAMWAIT        .set    EBCNTRS+16 ;how many tiks max between GROW calls
      53              0158  COLLWAIT        .set    EBCNTRS+24 ;how many tiks before growing after collision
      54                    
      55                    
      56 00000080                   .EVEN
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    2

      57 00000080                   .TEXT
      58                    **************************************************************************
      59                    *INIT TABLE
      60                    *       .LONG   OXVEL,OYVEL,OXVAL,XYVAL
      61                    *       .WORD   OZPOS,OZVEL
      62                    *       .LONG   OIMG,OZSIZ,OCVECT
      63                    *       .WORD   OFLAGS,OID
      64 00000080           HeadInit:
      65 00000080 00000000          .LONG   0,0,0,0
      66 00000100     0000          .WORD   0,0
      67 00000120 00000000!         .LONG   FLHD1A,FLAMZSIZ,FLAMCOLL
      68 00000180     8002          .WORD   DMAWNZ,FLAMEOID
      69 000001a0 00000000          .LONG   0
      70 000001c0           TailInit:
      71 000001c0 00000000          .LONG   0,0,0,0
      72 00000240     0000          .WORD   0,0
      73 00000260 00000000!         .LONG   FLTLA,FLAMZSIZ,FLAMCOLL
      74 000002c0     8002          .WORD   DMAWNZ,FLAMEOID
      75 000002e0 00000000          .LONG   0
      76                    **************************************************************************
      77                    
      78                    
      79                    **************************************************************************
      80 00000300           MAKEFLAM:
      81                    ;PARMS
      82                    ; A0 - X velocity
      83                    ; A1 - Y velocity
      84                    ; A2 - Z velocity
      85                    ; A3 - X coor of beginning animation pt (tip of gun barrel)
      86                    ; A4 - Y coor
      87                    ; A5 - Z coor
      88                    ; A6 - 0-0fHlame shooting to the right, 1-0fHlame to left
      89                    ;RETS
      90                    ; A0 - ptr to Flame Thrower Process, Z-flag set if failure
      91                    ;FUNCTION
      92                    ; Creates a Flame Thrower Process.
      93 00000300     098f          mmtm    SP,A0,A1,A2,A7
         00000310     e100  
      94 00000320     098f          mmtm    SP,A0,A1
         00000330     c000  
      95 00000340                   CREATE  FTHRWPID,FLAMETHROW ;allocate process   (bashes A1,A7)
      96 000003c0     09af          mmfm    SP,A1,A7        ;this is to pop A0,A1
         000003d0     0082  
      97 000003e0     ca1a          jrz     MAKEFX
      98 000003f0     b220          move    A1,*A0(FXVEL),L
         00000400     0100  
      99 00000410     b2e0          move    A7,*A0(ETEMP5),L
         00000420     0200  
     100 00000430     b240          move    A2,*A0(ETEMP6),L
         00000440     0220  
     101 00000450     b060          move    A3,*A0(HEADANIX),W
         00000460     0180  
     102 00000470     b080          move    A4,*A0(ETEMP3),W
         00000480     01c0  
     103 00000490     b0a0          move    A5,*A0(ETEMP4),W
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    3

         000004a0     01e0  
     104 000004b0     acc0          movb    A6,*A0(FLAMEDIR)
         000004c0     01a0  
     105                    
     106 000004d0     1961          movk    11,A1
     107 000004e0     ac20          movb    A1,*A0(SHRNKSPD) ;speed tail shrinks toward head
         000004f0     0140  
     108 00000500     18e1          movk    7,A1
     109 00000510     ac20          movb    A1,*A0(GROWSPD) ;speed head grows away from tail
         00000520     0148  
     110 00000530     1941          movk    10,A1
     111 00000540     ac20          movb    A1,*A0(FLAMWAIT) ;# tiks max between GROW calls
         00000550     0150  
     112 00000560     1861          movk    3,A1
     113 00000570     ac20          movb    A1,*A0(COLLWAIT) ;# tiks before growing after collision
         00000580     0158  
     114                    
     115 00000590           MAKEFX:
     116 00000590     09af          mmfm    SP,A0,A1,A2,A7
         000005a0     0087  
     117 000005b0     0960          rets
     118                    **************************************************************************
     119                    
     120                    
     121                    **************************************************************************
     122 000005c0           GROWFLAM:
     123                    ;PARMS
     124                    ; A0 - ptr to Flame Thrower Process
     125                    ;RETURNS nothing
     126                    ;FUNCTION
     127                    ; To keep the flame burning and growing,
     128                    ; GROWFLAM must be called at least every FLAMWAIT ticks or the Flame
     129                    ; Thrower Process will change to FLAMEOUT mode where the tail of the
     130                    ; flame begins to shrink forward into the head of the flame.
     131                    ; GROWFLAM sets the GROWING flag in the Flame Thrower Process.
     132                    ; If the process does not have an ID of FTHRWPID, GROWFLAM returns 
     133                    ; without performing any action.
     134 000005c0     098f          mmtm    SP,A1
         000005d0     4000  
     135 000005e0     b401          move    *A0(PROCID),A1,W
         000005f0     0020  
     136 00000600     0b41          cmpi    FTHRWPID,A1
         00000610     f00a  
     137 00000620     cb03          jrnz    GROWX
     138 00000630     1821          movk    1,A1
     139 00000640     ac20          movb    A1,*A0(GROWING)
         00000650     01c8  
     140 00000660           GROWX:
     141 00000660     09af          mmfm    SP,A1
         00000670     0002  
     142 00000680     0960          rets
     143                    **************************************************************************
     144                    
     145                    
     146                    **************************************************************************
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    4

     147 00000690           FLAMETHROW:
     148                    ;PROCESS Created by MAKEFLAM
     149                    ;PARMS
     150                    ;FLAMEDIR - direction
     151                    ;HEADANIX - X coor
     152                    ;ETEMP3 - Y coor
     153                    ;ETEMP4 - Z coor
     154                    ;EMAINT - XVEL 
     155                    ;ETEMP5 - YVEL
     156                    ;ETEMP6 - ZVEL
     157                    
     158                    
     159              001e  FLAME1LEN       .set    30
     160              0055  FLAME2LEN       .set    85
     161                    
     162                    ;create TAILOBJ - A8
     163                    ;create HEADOBJ - A10
     164 00000690     0d5f          calla   GETOBJ
         000006a0 00000000! 
     165 000006c0     cb03          jrnz    GotHd
     166 000006d0                   DIE
     167 00000700           GotHd:
     168 00000700     4c0a          move    A0,A10
     169                    
     170 00000710     0d5f          calla   GETOBJ
         00000720 00000000! 
     171 00000740     cb07          jrnz    GotTl
     172 00000750     4d40          move    A10,A0
     173 00000760     0d5f          calla   FREEOBJ
         00000770 00000000! 
     174 00000790                   DIE
     175 000007c0           GotTl:
     176 000007c0     4c08          move    A0,A8
     177                    
     178 000007d0     09e0          MOVI    NARCS,A0
         000007e0 00000000! 
     179 00000800     0d5f          CALLA   GETFPAL         ;GET A COLOR MAP ASSIGNMENT
         00000810 00000000! 
     180 00000830     cb08          jrnz    GotPal
     181 00000840     4d00          move    A8,A0
     182 00000850     0d5f          calla   FREEOBJ
         00000860 00000000! 
     183 00000880     4d40          move    A10,A0
     184 00000890     0d5f          calla   FREEOBJ
         000008a0 00000000! 
     185 000008c0           GotPal:
     186 000008c0     4c07          move    A0,A7
     187                    
     188 000008d0     4d00          move    A8,A0
     189 000008e0     09ee          movi    TailInit,A14
         000008f0 000001c0' 
     190 00000910     0d5f          calla   STFOBJ
         00000920 00000000! 
     191 00000940     b0e0          move    A7,*A0(OPAL),W
         00000950     0160  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    5

     192 00000960     b3a0          move    A13,*A0(OPLINK),L
         00000970     01f0  
     193 00000980     09e1          movi    ENEMY_BULLETS,A1
         00000990 00000000! 
     194 000009b0     0d5f          calla   ADDSUPP
         000009c0 00000000! 
     195                    
     196 000009e0     4d40          move    A10,A0
     197 000009f0     09ee          movi    HeadInit,A14
         00000a00 00000080' 
     198 00000a20     0d5f          calla   STFOBJ
         00000a30 00000000! 
     199 00000a50     b0e0          move    A7,*A0(OPAL),W
         00000a60     0160  
     200 00000a70     b3a0          move    A13,*A0(OPLINK),L
         00000a80     01f0  
     201 00000a90     09e1          movi    ENEMY_BULLETS,A1
         00000aa0 00000000! 
     202 00000ac0     0d5f          calla   ADDSUPP
         00000ad0 00000000! 
     203                    
     204                    ;USE PARMS
     205 00000af0     b7a0          move    *A13(ETEMP5),A0,L
         00000b00     0200  
     206 00000b10     b208          move    A0,*A8(OYVEL),L
         00000b20     0060  
     207 00000b30     b20a          move    A0,*A10(OYVEL),L
         00000b40     0060  
     208 00000b50     b7a0          move    *A13(ETEMP6),A0,L
         00000b60     0220  
     209 00000b70     b208          move    A0,*A8(OZVEL),L
         00000b80     00e0  
     210 00000b90     b20a          move    A0,*A10(OZVEL),L
         00000ba0     00e0  
     211                            
     212 00000bb0     afa0          movb    *A13(FLAMEDIR),A0
         00000bc0     01a0  
     213 00000bd0     ca0c          jrz     SkFixX
     214 00000be0     0d5f          calla   YFLP
         00000bf0 00000000! 
     215 00000c10                   SWAP    A8,A10
     216 00000c40     0d5f          calla   YFLP
         00000c50 00000000! 
     217 00000c70                   SWAP    A8,A10
     218 00000ca0           SkFixX:
     219 00000ca0     b5a1          move    *A13(HEADANIX),A1,W
         00000cb0     0180  
     220 00000cc0     b02d          move    A1,*A13(TAILANIX),W
         00000cd0     0190  
     221 00000ce0     b02d          move    A1,*A13(STRTANIX),W
         00000cf0     01b0  
     222                    
     223                    ;ETEMP3 - Y coor
     224 00000d00     b5a0          move    *A13(ETEMP3),A0,W
         00000d10     01c0  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    6

     225 00000d20     4c01          move    A0,A1
     226 00000d30     b702          move    *A8(OIMG),A2,L
         00000d40     0180  
     227 00000d50     b442          move    *A2(IANIOFFY),A2,W              
         00000d60     0030  
     228 00000d70     4440          sub     A2,A0
     229 00000d80     b008          move    A0,*A8(OYPOS),W
         00000d90     00b0  
     230 00000da0     b742          move    *A10(OIMG),A2,L
         00000db0     0180  
     231 00000dc0     b442          move    *A2(IANIOFFY),A2,W              
         00000dd0     0030  
     232 00000de0     4441          sub     A2,A1
     233 00000df0     b02a          move    A1,*A10(OYPOS),W
         00000e00     00b0  
     234                    ;ETEMP4 - Z coor
     235 00000e10     b5a0          move    *A13(ETEMP4),A0,W
         00000e20     01e0  
     236 00000e30     b008          move    A0,*A8(OZPOS),W
         00000e40     00d0  
     237 00000e50     1020          inc     A0                      ;head must be in front of tail
     238 00000e60     b00a          move    A0,*A10(OZPOS),W
         00000e70     00d0  
     239                    
     240 00000e80     4d00          move    A8,A0
     241 00000e90     0d5f          calla   INSOBJ
         00000ea0 00000000! 
     242 00000ec0     4d40          move    A10,A0
     243 00000ed0     0d5f          calla   INSOBJ
         00000ee0 00000000! 
     244                    
     245                    ;INITIALIZATION
     246 00000f00     5600          clr     A0
     247 00000f10     b20d          move    A0,*A13(COLLOBJ),L
         00000f20     00c0  
     248 00000f30     ac0d          movb    A0,*A13(ANICTR)
         00000f40     01a8  
     249 00000f50     ac0d          movb    A0,*A13(ANITIKS)
         00000f60     01e0  
     250 00000f70     ac0d          movb    A0,*A13(COLLTIKS)
         00000f80     01e8  
     251 00000f90     ac0d          movb    A0,*A13(FLAMTIKS)
         00000fa0     01f0  
     252 00000fb0     ac0d          movb    A0,*A13(FLAMEOUT)
         00000fc0     01c0  
     253 00000fd0     1820          movk    1,A0
     254 00000fe0     ac0d          movb    A0,*A13(GROWING)
         00000ff0     01c8  
     255                    
     256 00001000     09e0          movi    FLAME1,A0
         00001010 00002dd0' 
     257 00001030     b20d          move    A0,*A13(HEADANI),L
         00001040     00e0  
     258 00001050     09e0          movi    FLAME3,A0
         00001060 00002f50' 
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    7

     259 00001080     b20d          move    A0,*A13(TAILANI),L
         00001090     0120  
     260                    
     261                    ;every TIK
     262                    ;  if ANITIKS tiks have elapsed without animating,
     263                    ;    bump ANICTR by 1 (modulo 3), reset ANITIKS
     264                    ;    set ANITIKS to ANIWAIT
     265                    ;  if (COLLOBJ)
     266                    ;    set HEADANI to FLHIT
     267                    ;    set HEADANIX to COLLOBJ(ANIX)
     268                    ;    reset COLLWAIT, COLLOBJ
     269                    ;  else if COLLOBJ has been 0 for COLLWAIT tiks,
     270                    ;    extend HEADANIX from TAILANIX by GROWSPD
     271                    ;    if (HEADANI == FLHIT)
     272                    ;      if (ABS(HEADANIX - TAILANIX) > FLAME2LEN)
     273                    ;        HEADANI = FLAME2
     274                    ;        move HEADANIX back toward TAILANIX by FLAME2LEN
     275                    ;      else
     276                    ;        HEADANI = FLAME1
     277                    ;        HEADANIX = TAILANIX
     278                    ;  if (FLAMEOUT)
     279                    ;    while (ABS(HEADANIX - TAILANIX) <= SHRINKSPD)
     280                    ;      if (HEADANI != FLAME2)
     281                    ;        jump to FLAMDONE {deletes objs, proc dies}
     282                    ;      else
     283                    ;        HEADANI = FLAME1
     284                    ;        HEADANIX set away from TAILANIX by FLAME2LEN-FLAME1LEN
     285                    ;    move TAILANIX SHRINKSPD closer to HEADANIX
     286                    ;  else /*!FLAMEOUT*/
     287                    ;    if (GROWING)
     288                    ;      clear GROWING
     289                    ;      reset FLAMTIKS to FLAMWAIT
     290                    ;    if FLAMWAIT tiks have elapsed without GROWING set, 
     291                    ;      set FLAMEOUT, set Proc ID to FLOUTPID
     292                    ;    else
     293                    ;      if (HEADANI == FLAME1)
     294                    ;        if (ABS(HEADANIX - TAILANIX) > FLAME2LEN-FLAME1LEN)
     295                    ;          HEADANI = FLAME2
     296                    ;          HEADANIX moves toward TAILANIX by FLAME2LEN-FLAME1LEN
     297                    ;  DO ANIMATION
     298                    ;  plot head
     299                    ;  set head X coor to HEADANIX
     300                    ;  UNCLIP old Tail
     301                    ;  plot tail 
     302                    ;  compute new clip size
     303                    ;  CLIP new TAIL
     304                    ;  set tail X coor to TAILANIX
     305                    ;  Decrement tik ctrs
     306                    ;  SLEEP
     307                    
     308                    
     309                    ;every TIK
     310 000010a0           FlameLp:
     311                    ; update for X velocity 
     312 000010a0     b7a0          move    *A13(FXVEL),A0,L
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    8

         000010b0     0100  
     313 000010c0     b5a1          move    *A13(FXOFF),A1,W
         000010d0     01d0  
     314 000010e0     4020          add     A1,A0
     315 000010f0     4c01          move    A0,A1
     316 00001100     0521          zext    A1,W
     317 00001110     b02d          move    A1,*A13(FXOFF),W
         00001120     01d0  
     318 00001130     2a00          sra     16,A0
     319 00001140     b5a1          move    *A13(HEADANIX),A1,W
         00001150     0180  
     320 00001160     b5a2          move    *A13(STRTANIX),A2,W
         00001170     01b0  
     321 00001180     b5a3          move    *A13(TAILANIX),A3,W
         00001190     0190  
     322 000011a0     4001          add     A0,A1
     323 000011b0     b02d          move    A1,*A13(HEADANIX),W
         000011c0     0180  
     324 000011d0     4002          add     A0,A2
     325 000011e0     b04d          move    A2,*A13(STRTANIX),W
         000011f0     01b0  
     326 00001200     4003          add     A0,A3
     327 00001210     b06d          move    A3,*A13(TAILANIX),W
         00001220     0190  
     328                    
     329                    
     330                    ;  if (COLLOBJ)
     331 00001230     b7a0          move    *A13(COLLOBJ),A0,L
         00001240     00c0  
     332 00001250     ca1e          jrz     NoColl
     333                    ;    set HEADANI to FLHIT
     334 00001260     09e1          movi    FLHIT,A1
         00001270 00002d10' 
     335 00001290     b22d          move    A1,*A13(HEADANI),L
         000012a0     00e0  
     336                    ;    set HEADANIX to COLLOBJ(ANIX)
     337 000012b0     b401          move    *A0(OXPOS),A1,W
         000012c0     0090  
     338 000012d0     1141          addk    10,A1
     339 000012e0     afa2          movb    *A13(FLAMEDIR),A2
         000012f0     01a0  
     340 00001300     ca04          jrz     GotHX
     341 00001310     b402          move    *A0(OSIZEX),A2,W
         00001320     0140  
     342 00001330     4041          add     A2,A1
     343 00001340     1681          subk    20,A1
     344 00001350           GotHX:
     345 00001350     b02d          move    A1,*A13(HEADANIX),W
         00001360     0180  
     346                    ;    reset COLLWAIT, COLLOBJ
     347 00001370     bdad          movb    *A13(COLLWAIT),*A13(COLLTIKS)
         00001380     0158  
         00001390     01e8  
     348 000013a0     5600          clr     A0
     349 000013b0     b20d          move    A0,*A13(COLLOBJ),L
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE    9

         000013c0     00c0  
     350 000013d0     09e0          movi    FRYSND,A0
         000013e0 00000040' 
     351 00001400     0d5f          calla   ONESND
         00001410 00000000! 
     352 00001430     c027          jruc    SkNoColl
     353 00001440           NoColl:
     354                    ;  else if COLLOBJ has been 0 for COLLWAIT tiks,
     355 00001440     afa0          movb    *A13(COLLTIKS),A0
         00001450     01e8  
     356 00001460     c124          jrp     SkNoColl
     357                    ;    extend HEADANIX from TAILANIX by GROWSPD
     358 00001470     afa0          movb    *A13(GROWSPD),A0
         00001480     0148  
     359 00001490     0d3f          callr   HeadFwd
         000014a0     0129  
     360                    ;    if (HEADANI == FLHIT)
     361 000014b0     b7a0          move    *A13(HEADANI),A0,L
         000014c0     00e0  
     362 000014d0     0b60          cmpi    FLHIT,A0
         000014e0 ffffd2ef' 
     363 00001500     cb1a          jrnz    SkNoColl
     364                    ;      if (ABS(HEADANIX - TAILANIX) > FLAME2LEN)
     365 00001510     b5a0          move    *A13(HEADANIX),A0,W
         00001520     0180  
     366 00001530     b5a1          move    *A13(TAILANIX),A1,W
         00001540     0190  
     367 00001550     4420          sub     A1,A0
     368 00001560     0380          abs     A0
     369 00001570     0b40          cmpi    FLAME2LEN,A0
         00001580     ffaa  
     370 00001590     c609          jrle    DoFlame1
     371                    ;        HEADANI = FLAME2
     372 000015a0     09e0          movi    FLAME2,A0
         000015b0 00002e90' 
     373 000015d0     b20d          move    A0,*A13(HEADANI),L
         000015e0     00e0  
     374                    ;        move HEADANIX back toward TAILANIX by FLAME2LEN
     375 000015f0     09c0          movi    FLAME2LEN,A0
         00001600     0055  
     376 00001610     0d3f          callr   HeadBack
         00001620     0110  
     377                    ;      else
     378 00001630           DoFlame1:
     379                    ;        HEADANI = FLAME1
     380 00001630     09e0          movi    FLAME1,A0
         00001640 00002dd0' 
     381 00001660     b20d          move    A0,*A13(HEADANI),L
         00001670     00e0  
     382                    ;        HEADANIX = TAILANIX
     383 00001680     b9ad          move    *A13(TAILANIX),*A13(HEADANIX),W
         00001690     0190  
         000016a0     0180  
     384 000016b0           SkNoColl:
     385                    ;  if (FLAMEOUT)
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   10

     386 000016b0     afa0          movb    *A13(FLAMEOUT),A0
         000016c0     01c0  
     387 000016d0     ca3c          jrz     Growing
     388                    ;    while (ABS(HEADANIX - TAILANIX) <= SHRINKSPD)
     389 000016e0           CkLen:
     390 000016e0     b5a0          move    *A13(HEADANIX),A0,W
         000016f0     0180  
     391 00001700     b5a1          move    *A13(TAILANIX),A1,W
         00001710     0190  
     392 00001720     4420          sub     A1,A0
     393 00001730     afa1          movb    *A13(FLAMEDIR),A1
         00001740     01a0  
     394 00001750     ca01          jrz     SkNegDlt
     395 00001760     03a0          neg     A0
     396 00001770           SkNegDlt:
     397 00001770     afae          movb    *A13(SHRNKSPD),A14
         00001780     0140  
     398 00001790     49c0          cmp     A14,A0
     399 000017a0     c72a          jrgt    LenOk
     400                    ;      if (HEADANI != FLAME2)
     401 000017b0     b7a0          move    *A13(HEADANI),A0,L
         000017c0     00e0  
     402 000017d0     0b60          cmpi    FLAME2,A0
         000017e0 ffffd16f' 
     403 00001800     ca1a          jreq    NotOut
     404                    ;        FLAMDONE {deletes objs, proc dies}
     405 00001810     4d00          move    A8,A0
     406 00001820     0d5f          calla   DELPAL
         00001830 00000000! 
     407 00001850     09e1          movi    ENEMY_BULLETS,A1
         00001860 00000000! 
     408 00001880     0d5f          calla   DELSUPP
         00001890 00000000! 
     409 000018b0     0d5f          calla   DELOBJ
         000018c0 00000000! 
     410 000018e0     4d40          move    A10,A0
     411 000018f0     09e1          movi    ENEMY_BULLETS,A1
         00001900 00000000! 
     412 00001920     0d5f          calla   DELSUPP
         00001930 00000000! 
     413 00001950     0d5f          calla   DELOBJ
         00001960 00000000! 
     414 00001980                   DIE
     415                    
     416                    ;      else
     417 000019b0           NotOut:
     418                    ;        HEADANI = FLAME1
     419 000019b0     09e0          movi    FLAME1,A0
         000019c0 00002dd0' 
     420 000019e0     b20d          move    A0,*A13(HEADANI),L
         000019f0     00e0  
     421                    ;        HEADANIX set away from TAILANIX by FLAME2LEN-FLAME1LEN
     422 00001a00     09c0          movi    FLAME2LEN-FLAME1LEN,A0
         00001a10     0037  
     423 00001a20     0d3f          callr   HeadFwd
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   11

         00001a30     00d0  
     424 00001a40     c0c9          jruc    CkLen
     425 00001a50           LenOk:
     426                    ;    move TAILANIX SHRINKSPD closer to HEADANIX
     427 00001a50     afa0          movb    *A13(SHRNKSPD),A0
         00001a60     0140  
     428 00001a70     0d3f          callr   TailFwd
         00001a80     00e9  
     429 00001a90     c038          jruc    DoAni
     430                    ;  else /*!FLAMEOUT*/
     431 00001aa0           Growing:
     432                    ;    if (GROWING)
     433 00001aa0     afa0          movb    *A13(GROWING),A0
         00001ab0     01c8  
     434 00001ac0     ca06          jrz     SkGrowSt
     435                    ;      clear GROWING
     436 00001ad0     5600          clr     A0
     437 00001ae0     ac0d          movb    A0,*A13(GROWING)
         00001af0     01c8  
     438                    ;      reset FLAMTIKS to FLAMWAIT
     439 00001b00     bdad          movb    *A13(FLAMWAIT),*A13(FLAMTIKS)
         00001b10     0150  
         00001b20     01f0  
     440 00001b30           SkGrowSt:
     441                    ;Check to trigger flame sound
     442 00001b30     afa0          movb    *A13(SNDTIKS),A0
         00001b40     01f8  
     443 00001b50     c109          jrp     SkSnd
     444 00001b60     18a0          movk    5,A0
     445 00001b70     ac0d          movb    A0,*A13(SNDTIKS)
         00001b80     01f8  
     446 00001b90     09e0          movi    FLAMESND,A0
         00001ba0 00000000' 
     447 00001bc0     0d5f          calla   ONESND
         00001bd0 00000000! 
     448 00001bf0           SkSnd:
     449                    
     450                    ;    if FLAMWAIT tiks have elapsed without GROWING set, 
     451 00001bf0     afa0          movb    *A13(FLAMTIKS),A0
         00001c00     01f0  
     452 00001c10     c108          jrp     StilGrow
     453                    ;      set FLAMEOUT, set Proc ID to FLOUTPID
     454 00001c20     1820          movk    1,A0
     455 00001c30     ac0d          movb    A0,*A13(FLAMEOUT)
         00001c40     01c0  
     456 00001c50     09c0          movi    FLOUTPID,A0
         00001c60     0ff6  
     457 00001c70     b00d          move    A0,*A13(PROCID),W
         00001c80     0020  
     458 00001c90     c018          jruc    DoAni
     459 00001ca0           StilGrow:
     460                    ;    else
     461                    ;      if (HEADANI == FLAME1)
     462 00001ca0     b7a0          move    *A13(HEADANI),A0,L
         00001cb0     00e0  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   12

     463 00001cc0     0b60          cmpi    FLAME1,A0
         00001cd0 ffffd22f' 
     464 00001cf0     cb12          jrnz    DoAni
     465                    ;        if (ABS(HEADANIX - TAILANIX) > FLAME2LEN-FLAME1LEN)
     466 00001d00     b5a0          move    *A13(HEADANIX),A0,W
         00001d10     0180  
     467 00001d20     b5a1          move    *A13(TAILANIX),A1,W
         00001d30     0190  
     468 00001d40     4420          sub     A1,A0
     469 00001d50     0380          abs     A0
     470 00001d60     0b40          cmpi    FLAME2LEN-FLAME1LEN,A0
         00001d70     ffc8  
     471 00001d80     c609          jrle    DoAni
     472                    ;          HEADANI = FLAME2
     473 00001d90     09e0          movi    FLAME2,A0
         00001da0 00002e90' 
     474 00001dc0     b20d          move    A0,*A13(HEADANI),L
         00001dd0     00e0  
     475                    ;          HEADANIX moves toward TAILANIX by FLAME2LEN-FLAME1LEN
     476 00001de0     09c0          movi    FLAME2LEN-FLAME1LEN,A0
         00001df0     0037  
     477 00001e00     0d3f          callr   HeadBack
         00001e10     0091  
     478 00001e20           DoAni:
     479                    ;  DO ANIMATION
     480                    ;  if ANITIKS tiks have elapsed without animating,
     481 00001e20     afa0          movb    *A13(ANITIKS),A0
         00001e30     01e0  
     482 00001e40     c120          jrp     SkNxtAni
     483                    ;    bump ANICTR by 1 (modulo 3), reset ANITIKS
     484 00001e50     afa0          movb    *A13(ANICTR),A0
         00001e60     01a8  
     485 00001e70     1020          inc     A0
     486 00001e80     0b40          cmpi    3,A0
         00001e90     fffc  
     487 00001ea0     c401          jrlt    GotAniCt
     488 00001eb0     5600          clr     A0
     489 00001ec0           GotAniCt:
     490 00001ec0     ac0d          movb    A0,*A13(ANICTR)
         00001ed0     01a8  
     491                    ;    set ANITIKS to ANIWAIT
     492 00001ee0     1840          movk    ANIWAIT,A0
     493 00001ef0     ac0d          movb    A0,*A13(ANITIKS)
         00001f00     01e0  
     494                    
     495                            ;ANIMATE THE HEAD
     496 00001f10     b7a9          move    *A13(HEADANI),A9,L
         00001f20     00e0  
     497 00001f30     afa0          movb    *A13(ANICTR),A0
         00001f40     01a8  
     498 00001f50     24c0          sll     6,A0    ;2 longwords
     499 00001f60     4009          add     A0,A9
     500 00001f70     1881          movk    4,A1                    ;* one frame, no sleepin
     501 00001f80                   SWAP    A8,A10
     502 00001fb0                   jsrp    FRANIM
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   13

     503 00002020                   SWAP    A8,A10
     504 00002050           SkNxtAni:
     505                    
     506                    ;  set head X coor to HEADANIX
     507 00002050     b5a0          move    *A13(HEADANIX),A0,W
         00002060     0180  
     508 00002070     afa1          movb    *A13(FLAMEDIR),A1
         00002080     01a0  
     509 00002090     ca03          jrz     GotHXCoor
     510 000020a0     b541          move    *A10(OSIZEX),A1,W
         000020b0     0140  
     511 000020c0     4420          sub     A1,A0
     512 000020d0           GotHXCoor:
     513 000020d0     b00a          move    A0,*A10(OXPOS),W
         000020e0     0090  
     514                    
     515                    ;  plot tail 
     516                            ;*** COMPUTE WIDTH
     517 000020f0     b5a1          move    *A13(HEADANIX),A1,W
         00002100     0180  
     518 00002110     b5a2          move    *A13(TAILANIX),A2,W
         00002120     0190  
     519 00002130     4422          sub     A1,A2
     520 00002140     0382          abs     A2
     521 00002150     1142          addk    10,A2   ;amount of overlap between head and tail
     522                            ;*** GET FRAME  
     523 00002160     b7a1          move    *A13(TAILANI),A1,L
         00002170     0120  
     524 00002180     afa0          movb    *A13(ANICTR),A0
         00002190     01a8  
     525 000021a0     24a0          sll     5,A0    ;longwords
     526 000021b0     4001          add     A0,A1
     527 000021c0     8621          move    *A1,A1,L
     528 000021d0     0d3f          callr   ANIXCLIP
         000021e0     0024  
     529                    
     530                    ;  set tail X coor to TAILANIX
     531 000021f0     b5a0          move    *A13(TAILANIX),A0,W
         00002200     0190  
     532 00002210     afa1          movb    *A13(FLAMEDIR),A1
         00002220     01a0  
     533 00002230     ca03          jrz     GotTXCoor
     534 00002240     b501          move    *A8(OSIZEX),A1,W
         00002250     0140  
     535 00002260     4420          sub     A1,A0
     536 00002270           GotTXCoor:
     537 00002270     b008          move    A0,*A8(OXPOS),W
         00002280     0090  
     538                    
     539                    ;  Decrement tik ctrs
     540 00002290     afa0          movb    *A13(ANITIKS),A0
         000022a0     01e0  
     541 000022b0     1420          dec     A0
     542 000022c0     ac0d          movb    A0,*A13(ANITIKS)
         000022d0     01e0  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   14

     543 000022e0     afa0          movb    *A13(COLLTIKS),A0
         000022f0     01e8  
     544 00002300     1420          dec     A0
     545 00002310     ac0d          movb    A0,*A13(COLLTIKS)
         00002320     01e8  
     546 00002330     afa0          movb    *A13(FLAMTIKS),A0
         00002340     01f0  
     547 00002350     1420          dec     A0
     548 00002360     ac0d          movb    A0,*A13(FLAMTIKS)
         00002370     01f0  
     549 00002380     afa0          movb    *A13(SNDTIKS),A0
         00002390     01f8  
     550 000023a0     1420          dec     A0
     551 000023b0     ac0d          movb    A0,*A13(SNDTIKS)
         000023c0     01f8  
     552                    
     553 000023d0                   SLEEP   1
     554 00002410     c000          jruc    FlameLp
         00002420     fec7  
     555                    **************************************************************************
     556                    
     557                    **************************************************************************
     558 00002430           ANIXCLIP:
     559                    * A1=IMAGE POINTER
     560                    * A2=WIDTH OF IMAGE to BE PLOTTED
     561                    * A8=OBJECT STRUCTURE POINTER TO BE UPDATED
     562                    
     563                            ;* update Y pos
     564 00002430     b500          move    *A8(OYPOS),A0,W
         00002440     00b0  
     565 00002450     b703          move    *A8(OIMG),A3,L
         00002460     0180  
     566 00002470     4823          cmp     A1,A3
     567 00002480     ca0a          jreq    SkYAniOf
     568 00002490     b228          move    A1,*A8(OIMG),L
         000024a0     0180  
     569 000024b0     b464          move    *A3(IANIOFFY),A4,W      ;old anioffy
         000024c0     0030  
     570 000024d0     b425          move    *A1(IANIOFFY),A5,W      ;new anioffy
         000024e0     0030  
     571 000024f0     4485          sub     A4,A5
     572 00002500     44a0          sub     A5,A0           ;A0 = NewYpos
     573 00002510     b008          move    A0,*A8(OYPOS),W
         00002520     00b0  
     574 00002530           SkYAniOf:
     575                    
     576 00002530     b623          move    *A1(ISAG),A3,L
         00002540     0040  
     577 00002550     b704          move    *A8(OFLAGS),A4,L
         00002560     0100  
     578 00002570     8627          move    *A1,A7,L        ;(ISIZE) = 0
     579 00002580     1067          addk    3,A7
     580 00002590     2fc7          srl     2,A7
     581 000025a0     2447          sll     2,A7
     582                            
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   15

     583 000025b0     eee2          movy    A7,A2
     584 000025c0     e247          subxy   A2,A7           ;clip = ISIZEX - WIDTH plotted
     585 000025d0     1f64          btst    B_FLIPH,A4
     586 000025e0     cb04          jrnz    XFlipped
     587                    
     588 000025f0           NonFlp:
     589 000025f0     4ce5          move    A7,A5
     590 00002600     2605          sll     16,A5           ; offset = clip
     591 00002610     eea4          movy    A5,A4
     592 00002620     c008          jruc    StfAni
     593                            
     594 00002630           XFlipped:
     595 00002630     ec45          movx    A2,A5
     596 00002640     0525          zext    A5,W
     597 00002650     2465          sll     3,A5
     598 00002660     40a3          add     A5,A3           ;SAG += OSIZEX<<3
     599 00002670     2fc5          srl     2,A5
     600 00002680     40e5          add     A7,A5           ;OFFSET = 2*OSIZEX+CLIP
     601 00002690     2605          sll     16,A5           ; << 3
     602 000026a0     eea4          movy    A5,A4
     603                    
     604 000026b0           StfAni:
     605 000026b0     4d00          move    A8,A0           ;GET PUSH ADDRESS OF OFLAGS,OSAG,OSIZE
     606 000026c0     0b00          ADDI    OFLAGS+060H,A0
         000026d0     0160  
     607 000026e0     b0e8          MOVE    A7,*A8(OXCLIP),W
         000026f0     0230  
     608                            ;A4 - OFLAGS:OFFSET, A3 - OSAG, A2 - OSIZE
     609 00002700     0980          MMTM    A0,A2,A3,A4     ;BLOW STUFF OUT without interruption
         00002710     3800  
     610                    
     611 00002720     0960          rets
     612                    **************************************************************************
     613                    
     614                    **************************************************************************
     615 00002730           HeadBack:
     616 00002730     03a0          neg     A0
     617 00002740           HeadFwd:
     618 00002740     098f          mmtm    SP,A1,A2,A3
         00002750     7000  
     619 00002760     afa1          movb    *A13(FLAMEDIR),A1
         00002770     01a0  
     620 00002780     ca01          jrz     SkNegHd
     621 00002790     03a0          neg     A0
     622 000027a0           SkNegHd:
     623 000027a0     b5a1          move    *A13(HEADANIX),A1,W
         000027b0     0180  
     624 000027c0     4001          add     A0,A1
     625 000027d0     b5a2          move    *A13(STRTANIX),A2,W
         000027e0     01b0  
     626 000027f0     4c43          move    A2,A3
     627 00002800     4422          sub     A1,A2
     628 00002810     0382          abs     A2
     629 00002820     0b42          cmpi    300,A2
         00002830     fed3  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   16

     630 00002840     c608          jrle    GotNHead
     631 00002850     09c2          movi    300,A2
         00002860     012c  
     632 00002870     afa1          movb    *A13(FLAMEDIR),A1
         00002880     01a0  
     633 00002890     ca01          jrz     SkNgNHd
     634 000028a0     03a2          neg     A2
     635 000028b0           SkNgNHd:
     636 000028b0     4043          add     A2,A3
     637 000028c0     4c61          move    A3,A1
     638 000028d0           GotNHead:
     639 000028d0     b02d          move    A1,*A13(HEADANIX),W
         000028e0     0180  
     640 000028f0     09af          mmfm    SP,A1,A2,A3
         00002900     000e  
     641 00002910     0960          rets
     642                    **************************************************************************
     643                    
     644                    **************************************************************************
     645 00002920           TailFwd:
     646 00002920     098f          mmtm    SP,A1
         00002930     4000  
     647 00002940     afa1          movb    *A13(FLAMEDIR),A1
         00002950     01a0  
     648 00002960     ca01          jrz     SkNegTl
     649 00002970     03a0          neg     A0
     650 00002980           SkNegTl:
     651 00002980     b5a1          move    *A13(TAILANIX),A1,W
         00002990     0190  
     652 000029a0     4001          add     A0,A1
     653 000029b0     b02d          move    A1,*A13(TAILANIX),W
         000029c0     0190  
     654 000029d0     09af          mmfm    SP,A1
         000029e0     0002  
     655 000029f0     0960          rets
     656                    **************************************************************************
     657                    
     658 00002a00           FLAMCOLL:
     659 00002a00     0be1          .WORD   BEOID|FLAMEID
     660 00002a10 00000000!         .LONG   DUMRTSG
     661 00002a30     0be0          .WORD   BEOID|BULLETID
     662 00002a40 00000000!         .LONG   DUMRTSG
     663 00002a60     0be7          .WORD   BEOID|DYNAID
     664 00002a70 00000000!         .LONG   DUMRTSG
     665 00002a90     0be4          .WORD   BEOID|ROCKETID
     666 00002aa0 00000000!         .LONG   DUMRTSG
     667                    
     668 00002ac0     0b10          .WORD   B1OID|BULLETID
     669 00002ad0 00000000!         .LONG   DUMRTSG
     670 00002af0     0b14          .WORD   B1OID|ROCKETID
     671 00002b00 00000000!         .LONG   DUMRTSG
     672 00002b20     0b11          .WORD   B1OID|FLAMEID
     673 00002b30 00000000!         .LONG   DUMRTSG
     674                    
     675 00002b50     0b20          .WORD   B2OID|BULLETID
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   17

     676 00002b60 00000000!         .LONG   DUMRTSG
     677 00002b80     0b24          .WORD   B2OID|ROCKETID
     678 00002b90 00000000!         .LONG   DUMRTSG
     679 00002bb0     0b21          .WORD   B2OID|FLAMEID
     680 00002bc0 00000000!         .LONG   DUMRTSG
     681                    
     682 00002be0     0000          .WORD   0
     683 00002bf0 00002c10'         .LONG   FlamColl
     684                    
     685 00002c10           FlamColl:
     686                    ;A0 - ptr to flame obj
     687                    ;A8 - ptr to obj struck
     688 00002c10     b600          move    *A0(OPLINK),A0,L
         00002c20     01f0  
     689 00002c30     b300          move    A8,*A0(COLLOBJ),L
         00002c40     00c0  
     690                    
     691 00002c50     4d00          move    A8,A0
     692 00002c60     0d5f          calla   GetPData
         00002c70 00000000! 
     693 00002c90     4c02          move    A0,A2
     694 00002ca0     ca05          jrz     SkBurnPl
     695 00002cb0     09c0          movi    06000H,A0
         00002cc0     6000  
     696 00002cd0     0d5f          calla   BUGBITE
         00002ce0 00000000! 
     697 00002d00           SkBurnPl
     698                    
     699 00002d00     0960          rets
     700                    **************************************************************************
     701                    
     702                    
     703                    **************************************************************************
     704 00002d10           FLHIT:
     705 00002d10 00000000!         .long   FLHIT1
     706 00002d30     0001          .word   1,0
     707 00002d50 00000000!         .long   FLHIT2
     708 00002d70     0001          .word   1,0
     709 00002d90 00000000!         .long   FLHIT3
     710 00002db0     0001          .word   1,0
     711                    
     712                    **************************************************************************
     713                    *                                                                        *
     714                    * FLAME0:                                                                *
     715                    *       .long   FL1                                                      *
     716                    *       .word   1,0                                                      *
     717                    *       .long   FL2                                                      *
     718                    *       .word   1,0                                                      *
     719                    *       .long   FL3                                                      *
     720                    *       .word   1,0                                                      *
     721                    *                                                                        *
     722                    **************************************************************************
     723 00002dd0           FLAME1:
     724 00002dd0 00000000!         .long   FLHD1A
     725 00002df0     0001          .word   1,0
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:21:16 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- FLAME THROWER >>>                                PAGE   18

     726 00002e10 00000000!         .long   FLHD1B
     727 00002e30     0001          .word   1,0
     728 00002e50 00000000!         .long   FLHD1C
     729 00002e70     0001          .word   1,0
     730 00002e90           FLAME2:
     731 00002e90 00000000!         .long   FLHD2A
     732 00002eb0     0001          .word   1,0
     733 00002ed0 00000000!         .long   FLHD2B
     734 00002ef0     0001          .word   1,0
     735 00002f10 00000000!         .long   FLHD2C
     736 00002f30     0001          .word   1,0
     737                    
     738 00002f50           FLAME3:
     739 00002f50 00000000!         .long   FLTLA
     740 00002f70 00000000!         .long   FLTLB
     741 00002f90 00000000!         .long   FLTLC
     742                    

 No Errors,  No Warnings
