TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

                                                                     PAGE    1

       1                            .FILE   "NARCCARS.ASM"
       3                    
       4                    **************************************************************************
       5                    *                                                                        *
       6                    *       COPYRIGHT (C) 1988 WILLIAMS ELECTRONICS GAMES, INC.              *
       7                    *       ALL RIGHTS RESERVED.                                             *
       8                    *                                                                        *
       9                    **************************************************************************
      10                    
      11                            .WIDTH  132
      12                            .OPTION B,D,L
      13                            .MNOLIST
      14                    
      15                    *       GET THE SYSTEM STUFF
      16                            .INCLUDE        "\video\MPROCEQU.ASM"   ;MPROC equates
      17                            .INCLUDE        "\video\DISPEQU.ASM"    ;Display processor equates
      18                            .INCLUDE        "\video\GSP.INC"        ;GSP assembler equates
      19                            .INCLUDE        "\video\SYS.INC"        ;Zunit system equates
      20                            .INCLUDE        "\video\MACROS.HDR"     ;Macros, Yeah!
      21                    *       LOCAL STUFF
      22                            .INCLUDE        "NARCEQU.ASM"           ;NARC Equates
      23                    
      24                    *
      25                    *GLOBALS IN THIS FILE
      26                            .GLOBAL CNEWPAL
      27                    
      28 00000000                   .TEXT
      29                    
      30                    **************************************************************************
      31                    *                                                                        *
      32                    *       VEHICLE(MULTI-PART OBJECT) CONTROL ROUTINES                      *
      33                    *       -------------------------------------------                      *
      34                    *                                                                        *
      35                    * PROCESS BLOCK VARIABLES:                                               *
      36                    * -----------------------                                                *
      37                    *       A8      = PTR TO DRIVER/PILOT/ETC.                               *
      38                    *       A10     = PTR TO MAIN VEHICLE BODY PART                          *
      39                    *       ETEMP1\                                                          *
      40                    *         .    \                                                         *
      41                    *         .     > = PARTS, OPLINK PROCESS IS KILLED UPON DELETION        *
      42                    *         .    /                                                         *
      43                    *       ETEMP6/                                                          *
      44                    *                                                                        *
      45                    *       ETEMP7  \                                                        *
      46                    *       ETEMP8    = PART, OPLINK PROCESS IS NOT KILLED UPON DELETION     *
      47                    *                                           ---                          *
      48                    *                                                                        *
      49                    **************************************************************************
      50                    **************************************************************************
      51                    *                                                                        *
      52                    * CARINIT - INITIALIZE A VEHICLE TOTALLY, AND INSERT IT ON THE OBJECT LI *
      53                    * A6 = PTR TO THE DRIVER AND CAR ANIMATION TABLE                         *
      54                    * A13 = PTR TO PROC BLOCK                                                *
      55                    * A14 = PTR TO INITIALIZATION LIST                                       *
      56                    * RETURNS:                                                               *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    2

      57                    * A8 = PTR TO THE DRIVER                                                 *
      58                    * A10 = PTR TO THE MAIN CAR                                              *
      59                    * *A13(ETEMP1) - *A13(ETEMP8) = PTRS TO THE CAR PARTS                    *
      60                    * Z BIT CLR = SUCCESS                                                    *
      61                    * Z BIT SET = FAILURE                                                    *
      62                    *                                                                        *
      63                    **************************************************************************
      64 00000000           CARINIT
      65 00000000     098f          MMTM    SP,A0,A1,A9,A11
         00000010     c050  
      66 00000020     099f          MMTM    SP,B1,B2,B3
         00000030     7000  
      67 00000040     0d5f          CALLA   CLRPDATA                ;CLEAR THE PDATA AREA
         00000050 00000000! 
      68 00000070     0d5f          CALLA   GPALOBJ
         00000080 00000000! 
      69 000000a0     ca00          JRZ     CARINIFL                ;PALETTE CAR CREATE ERROR
         000000b0     00a1  
      70 000000c0     0d5f          CALLA   STFOBJ                  ;SETUP MAIN VEHICLE BODY                                        
         000000d0 00000000! 
      71 000000f0     0d5f          CALLA   ADJSTWTL
         00000100 00000000! 
      72 00000120     b60a          MOVE    *A0(OZVAL),A10,L
         00000130     00c0  
      73 00000140     cb03          JRNZ    CARNOZST                ;BR = HE SET HIS OWN Z POSITION
      74 00000150     0d5f          CALLA   SETZPOS                                                  
         00000160 00000000! 
      75 00000180           CARNOZST
      76 00000180     b3a0          MOVE    A13,*A0(OPLINK),L       ;PROCESS LINK                    
         00000190     01f0  
      77 000001a0     4c0a          MOVE    A0,A10
      78                    
      79 000001b0     0d3f          CALLR   CINIPART
         000001c0     00ab  
      80 000001d0     ca07          JRZ     CADTEMP2
      81 000001e0     b20d          MOVE    A0,*A13(ETEMP1),L       ;STORE WINDSHIELD POINTER        
         000001f0     0180  
      82 00000200     b741          MOVE    *A10(OZVAL),A1,L
         00000210     00c0  
      83 00000220     1041          ADDK    2,A1
      84 00000230     b220          MOVE    A1,*A0(OZVAL),L         ;WINDSHIELD Z = CAR Z + 2
         00000240     00c0  
      85 00000250           CADTEMP2
      86 00000250     0d3f          CALLR   CINIPART
         00000260     00a1  
      87 00000270     ca07          JRZ     CADTEMP3
      88 00000280     b20d          MOVE    A0,*A13(ETEMP2),L       ;STORE TRUNK OBJECT POINTER
         00000290     01a0  
      89 000002a0     b741          MOVE    *A10(OZVAL),A1,L
         000002b0     00c0  
      90 000002c0     1041          ADDK    2,A1
      91 000002d0     b220          MOVE    A1,*A0(OZVAL),L         ;TRUNK Z = CAR Z + 2
         000002e0     00c0  
      92 000002f0           CADTEMP3
      93 000002f0     0d3f          CALLR   CINIPART
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    3

         00000300     0097  
      94 00000310     ca07          JRZ     CADTEMP4
      95 00000320     b20d          MOVE    A0,*A13(ETEMP3),L       ;STORE FRONT WHEEL OBJECT POINTER
         00000330     01c0  
      96 00000340     b741          MOVE    *A10(OZVAL),A1,L
         00000350     00c0  
      97 00000360     1421          DEC     A1                      ;KEEP THE WHEEL BEHIND THE BODY
      98 00000370     b220          MOVE    A1,*A0(OZVAL),L
         00000380     00c0  
      99 00000390           CADTEMP4
     100 00000390     0d3f          CALLR   CINIPART
         000003a0     008d  
     101 000003b0     ca07          JRZ     CADTEMP5
     102 000003c0     b20d          MOVE    A0,*A13(ETEMP4),L       ;STORE REAR WHEEL OBJECT POINTER
         000003d0     01e0  
     103 000003e0     b741          MOVE    *A10(OZVAL),A1,L
         000003f0     00c0  
     104 00000400     1421          DEC     A1                      ;KEEP THE WHEEL BEHIND THE BODY
     105 00000410     b220          MOVE    A1,*A0(OZVAL),L
         00000420     00c0  
     106 00000430           CADTEMP5
     107 00000430     0d3f          CALLR   CINIPART
         00000440     0083  
     108 00000450     ca07          JRZ     CADTEMP6
     109 00000460     b20d          MOVE    A0,*A13(ETEMP5),L
         00000470     0200  
     110 00000480     b741          MOVE    *A10(OZVAL),A1,L
         00000490     00c0  
     111 000004a0     1021          INC     A1
     112 000004b0     b220          MOVE    A1,*A0(OZVAL),L
         000004c0     00c0  
     113 000004d0           CADTEMP6
     114 000004d0     0d3f          CALLR   CINIPART
         000004e0     0079  
     115 000004f0     ca07          JRZ     CADTEMP7
     116 00000500     b20d          MOVE    A0,*A13(ETEMP6),L       ;STORE OBJECT POINTER
         00000510     0220  
     117 00000520     b741          MOVE    *A10(OZVAL),A1,L
         00000530     00c0  
     118 00000540     1021          INC     A1
     119 00000550     b220          MOVE    A1,*A0(OZVAL),L
         00000560     00c0  
     120 00000570           CADTEMP7
     121 00000570     0d3f          CALLR   CINIPART                ;THIS PART DOES NOT KILL IT'S PROC
         00000580     006f  
     122 00000590     ca09          JRZ     CADTEMP8
     123 000005a0     b20d          MOVE    A0,*A13(ETEMP7),L       ;STORE OBJECT POINTER
         000005b0     0240  
     124 000005c0     b3a0          MOVE    A13,*A0(OPLINK),L
         000005d0     01f0  
     125 000005e0     b741          MOVE    *A10(OZVAL),A1,L
         000005f0     00c0  
     126 00000600     1021          INC     A1               
     127 00000610     b220          MOVE    A1,*A0(OZVAL),L
         00000620     00c0  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    4

     128 00000630           CADTEMP8
     129 00000630     0d3f          CALLR   CINIPART                ;THIS PART DOES NOT KILL IT'S PROC
         00000640     0063  
     130 00000650     ca09          JRZ     CDRVINIT
     131 00000660     b20d          MOVE    A0,*A13(ETEMP8),L       ;STORE OBJECT POINTER
         00000670     0260  
     132 00000680     b3a0          MOVE    A13,*A0(OPLINK),L
         00000690     01f0  
     133 000006a0     b741          MOVE    *A10(OZVAL),A1,L
         000006b0     00c0  
     134 000006c0     1021          INC     A1
     135 000006d0     b220          MOVE    A1,*A0(OZVAL),L
         000006e0     00c0  
     136                    
     137                    *
     138                    *INTIALIZE THE DRIVER                                                    
     139 000006f0           CDRVINIT
     140 000006f0     87c0          MOVE    *A14,A0,L
     141 00000700     0b60          CMPI    07FFF7FFFH,A0
         00000710 80008000  
     142 00000730     cb04          JRNE    CDRIVER
     143 00000740     5708          CLR     A8
     144 00000750     b2cd          MOVE    A6,*A13(EMAINT),L       ;STILL STUFF THIS THING
         00000760     0100  
     145 00000770     c01a          JRUC    CADDALL
     146 00000780           CDRIVER
     147 00000780     4f43          MOVE    A10,B3
     148 00000790     b5c1          MOVE    *A14(50H),A1,W
         000007a0     0050  
     149 000007b0     b5c2          MOVE    *A14(70H),A2,W
         000007c0     0070  
     150 000007d0     2602          SLL     16,A2
     151 000007e0     ee41          MOVY    A2,A1           ;FUDGE OUT THE POSITION FOR ENINIT
     152 000007f0     0d5f          CALLA   ENINIT          ;INITIALIZE THE DRIVER                   
         00000800 00000000! 
     153 00000820     cb02          JRNZ    CARDRIVE        ;BR = DRIVER, CONTINUE  
     154 00000830     4e7a          MOVE    B3,A10          ;GRAB THE CADILLAC POINTER               
     155 00000840     c02d          JRUC    CARNODRV        ;AND STOP THE SHOW                                                      
     156 00000850           CARDRIVE
     157 00000850     4e7a          MOVE    B3,A10          ;A10 = PTR TO CADILLAC
     158 00000860     4d00          MOVE    A8,A0
     159 00000870     0d5f          CALLA   ADJSTWTL
         00000880 00000000! 
     160 000008a0     0d5f          CALLA   DELSHAD
         000008b0 00000000! 
     161 000008d0     b741          MOVE    *A10(OZVAL),A1,L
         000008e0     00c0  
     162 000008f0     1021          INC     A1
     163 00000900     b228          MOVE    A1,*A8(OZVAL),L ;DRIVER Z = CAR Z + 1
         00000910     00c0  
     164                    
     165 00000920           CADDALL
     166 00000920     09e1          MOVI    CARLIST,A1
         00000930 00000000! 
     167 00000950     4d40          MOVE    A10,A0
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    5

     168 00000960     0d5f          CALLA   INSOBJ          ;ADD THE CADDY                                                   
         00000970 00000000! 
     169 00000990     0d5f          CALLA   ADDSUPP
         000009a0 00000000! 
     170                    
     171 000009c0     4dae          MOVE    A13,A14
     172 000009d0     0b0e          ADDI    ETEMP1,A14
         000009e0     0180  
     173 000009f0     1912          MOVK    NPARTS,B2       ;INSERT ALL TEMP AREA'S
     174 00000a00           CADTMPIN
     175 00000a00     97c0          MOVE    *A14+,A0,L
     176 00000a10     ca06          JRZ     CADTMPI1        ;BR = THERE'S NOTHING HERE
     177 00000a20     0d5f          CALLA   INSOBJ                                                   
         00000a30 00000000! 
     178 00000a50     0d5f          CALLA   ADDSUPP
         00000a60 00000000! 
     179 00000a80           CADTMPI1
     180 00000a80     3d32          DSJS    B2,CADTMPIN
     181 00000a90     5600          CLR     A0
     182 00000aa0     b00d          MOVE    A0,*A13(ERESET),W       ;CLEAR THE RESET COUNTER
         00000ab0     0120  
     183 00000ac0     4d4a          MOVE    A10,A10         ;INDICATE SUCCESS
     184 00000ad0           CARINIFL
     185 00000ad0     09bf          MMFM    SP,B1,B2,B3
         00000ae0     000e  
     186 00000af0     09af          MMFM    SP,A0,A1,A9,A11
         00000b00     0a03  
     187 00000b10     0960          RETS
     188                    
     189                    *THE DRIVER UNINTENTIONALY COULD NOT BE CREATED, WIPE OUT ALL THIS WORK
     190 00000b20           CARNODRV
     191 00000b20     4d40          MOVE    A10,A0                                           
     192 00000b30     0d5f          CALLA   DELPAL
         00000b40 00000000! 
     193 00000b60     0d5f          CALLA   FREEOBJ
         00000b70 00000000! 
     194                    
     195 00000b90     4da1          MOVE    A13,A1
     196 00000ba0     0b01          ADDI    ETEMP1,A1
         00000bb0     0180  
     197 00000bc0     1912          MOVK    NPARTS,B2               ;DELETE ALL TEMP AREA'S
     198 00000bd0           CARNOD1
     199 00000bd0     9620          MOVE    *A1+,A0,L
     200 00000be0     ca06          JRZ     CARNOD2                 ;BR = THERE'S NOTHING HERE
     201 00000bf0     0d5f          CALLA   DELPAL
         00000c00 00000000! 
     202 00000c20     0d5f          CALLA   FREEOBJ
         00000c30 00000000! 
     203 00000c50           CARNOD2
     204 00000c50     3d32          DSJS    B2,CARNOD1
     205 00000c60     574a          CLR     A10
     206 00000c70     c0e5          JRUC    CARINIFL
     207                    
     208                    **************************************************************************
     209                    *                                                                        *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    6

     210                    * CINIPART - INITIALIZE A PART OF THE CAR, TO BE USED WITH CARINIT       *
     211                    * RETURNS:                                                               *
     212                    * A14 = PTR TO NEXT INIT TABLE                                           *
     213                    * Z BIT CLR = SUCCESS ---> A0 = PTR TO OBJECT                            *
     214                    * Z BIT SET = FAILURE ---> A0 = 0                                        *
     215                    *                                                                        *
     216                    **************************************************************************
     217 00000c80           CINIPART
     218 00000c80     97c0          MOVE    *A14+,A0,L
     219 00000c90     0b60          CMPI    07FFF7FFFH,A0
         00000ca0 80008000  
     220 00000cc0     ca0f          JREQ    CIPARTF1                ;BR = THERE'S NO PART HERE
     221 00000cd0     140e          SUBK    32,A14                  ;RESET POINTER
     222 00000ce0     0d5f          CALLA   GPALOBJ
         00000cf0 00000000! 
     223 00000d10     ca08          JRZ     CIPARTF                 ;BR = OBJ/PALETTE FAILURE
     224 00000d20     0d5f          CALLA   STFOBJ                                                   
         00000d30 00000000! 
     225 00000d50     0d5f          CALLA   ADJSTWTL
         00000d60 00000000! 
     226 00000d80     4c00          MOVE    A0,A0                   ;CLR Z BIT
     227 00000d90     0960          RETS
     228 00000da0           CIPARTF
     229 00000da0     0b0e          ADDI    18*16,A14               ;GET TO THE NEXT INIT. TABLE
         00000db0     0120  
     230 00000dc0           CIPARTF1
     231 00000dc0     5600          CLR     A0                      ;SET Z BIT
     232 00000dd0     0960          RETS
     233                    
     234                    **************************************************************************
     235                    *                                                                        *
     236                    * CDELALL - DELETE ALL VEHICLE PARTS AND DRIVER, EXCEPT FOR THE          *
     237                    *         MAIN(A10 = PTR).                                               *
     238                    * A8 = PTR TO DRIVER                                                     *
     239                    * A10 = PTR TO MAIN                                                      *
     240                    * A13 = PROCBLOC                                                         *
     241                    *                                                                        *
     242                    **************************************************************************
     243 00000de0           CDELALL
     244 00000de0     098f          MMTM    SP,A0,A1,A6,A8,A14
         00000df0     c282  
     245 00000e00     0d3f          CALLR   KILLCARP                ;KILL A CAR PROCESS
         00000e10     0169  
     246 00000e20     09e1          MOVI    ENEMIES,A1
         00000e30 00000000! 
     247 00000e50     4d00          MOVE    A8,A0                                                    
     248 00000e60     ca09          JREQ    CDELALL1
     249 00000e70     0d5f          CALLA   DELPAL
         00000e80 00000000! 
     250 00000ea0     0d5f          CALLA   DELSUPP
         00000eb0 00000000! 
     251 00000ed0     0d5f          CALLA   DELSOBJ                 ;BYE BYE DRIVER                  
         00000ee0 00000000! 
     252 00000f00           CDELALL1
     253 00000f00     09e1          MOVI    CARLIST,A1
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    7

         00000f10 00000000! 
     254 00000f30     4dae          MOVE    A13,A14
     255 00000f40     0b0e          ADDI    ETEMP1,A14
         00000f50     0180  
     256 00000f60     18c6          MOVK    NPARTS-2,A6             ;DELETE ALL TEMP AREA'S
     257 00000f70           CDELALL2
     258 00000f70     97c8          MOVE    *A14+,A8,L
     259 00000f80     ca10          JRZ     CDELALL4                ;BR = THERE'S NOTHING HERE
     260 00000f90     b700          MOVE    *A8(OPLINK),A0,L
         00000fa0     01f0  
     261 00000fb0     ca03          JREQ    CDELALL3
     262 00000fc0     0d5f          CALLA   KILL                    ;KILL ANIMATING PROC.
         00000fd0 00000000! 
     263 00000ff0           CDELALL3
     264 00000ff0     4d00          MOVE    A8,A0
     265 00001000     0d5f          CALLA   DELPAL
         00001010 00000000! 
     266 00001030     0d5f          CALLA   DELSUPP                                                  
         00001040 00000000! 
     267 00001060     0d5f          CALLA   DELSOBJ
         00001070 00000000! 
     268 00001090           CDELALL4
     269 00001090     3e66          DSJS    A6,CDELALL2
     270 000010a0     1846          MOVK    2,A6
     271 000010b0           CDELAL4A
     272 000010b0     97c0          MOVE    *A14+,A0,L
     273 000010c0     ca09          JRZ     CDELALL5
     274 000010d0     0d5f          CALLA   DELPAL                  ;JUST DELETE ETEMP6
         000010e0 00000000! 
     275 00001100     0d5f          CALLA   DELSUPP                                                  
         00001110 00000000! 
     276 00001130     0d5f          CALLA   DELSOBJ
         00001140 00000000! 
     277 00001160           CDELALL5
     278 00001160     3d86          DSJS    A6,CDELAL4A
     279 00001170     09af          MMFM    SP,A0,A1,A6,A8,A14
         00001180     4143  
     280 00001190     0960          RETS
     281                    
     282                    
     283                    **************************************************************************
     284                    *                                                                        *
     285                    * DELCBODY - DELETE THE CAR BODY FROM THE OBJECT LIST AND,               *
     286                    *               CARLIST.                                                 *
     287                    *                ALSO DELETE THE SHADOW FROM THE OBJLST.                 *
     288                    * A10 = PTR TO ENEMY OBLOCK                                              *
     289                    *                                                                        *
     290                    **************************************************************************
     291 000011a0           DELCBODY
     292 000011a0                   PUSH    A1
     293 000011b0     09e1          MOVI    CARLIST,A1
         000011c0 00000000! 
     294 000011e0     4d40          MOVE    A10,A0
     295 000011f0     0d5f          CALLA   DELPAL
         00001200 00000000! 
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    8

     296 00001220     0d5f          CALLA   DELSUPP
         00001230 00000000! 
     297 00001250     0d5f          CALLA   DELSOBJ
         00001260 00000000! 
     298 00001280                   PULL    A1
     299 000012a0     0960          RETS
     300                    
     301                    **************************************************************************
     302                    *                                                                        *
     303                    * CNEWPAL - STORE A NEW PALETTE TO THE VEHICLE                           *
     304                    * A1 = NEW PALETTE                                                       *
     305                    * A8 = DRIVER/PILOT                                                      *
     306                    * A10 = PTR TO MAIN                                                      *
     307                    * A13 = PROCESS BLOCK                                                    *
     308                    *                                                                        *
     309                    **************************************************************************
     310 000012b0           CNEWPAL
     311 000012b0     098f          MMTM    SP,A0,A2,A3,A6,A14
         000012c0     b202  
     312 000012d0     4c20          MOVE    A1,A0
     313 000012e0     0d5f          CALLA   GETFPAL
         000012f0 00000000! 
     314 00001310     ca1a          JRZ     CNEWPALX                ;NO PALETTES AVAILABLE
     315 00001320     4c02          MOVE    A0,A2
     316 00001330     4d40          MOVE    A10,A0
     317 00001340     0d5f          CALLA   DELPAL
         00001350 00000000! 
     318 00001370     b04a          MOVE    A2,*A10(OPAL),W
         00001380     0160  
     319                    
     320 00001390     4dae          MOVE    A13,A14
     321 000013a0     0b0e          ADDI    ETEMP1,A14
         000013b0     0180  
     322 000013c0     09c6          MOVI    NPARTS-1,A6             ;SKIP THE PASSENGER
         000013d0     0007  
     323 000013e0           CNEWPLP
     324 000013e0     97c2          MOVE    *A14+,A2,L
     325 000013f0     ca0b          JRZ     CNEWPLCT
     326 00001400     4c20          MOVE    A1,A0
     327 00001410     0d5f          CALLA   GETFPAL
         00001420 00000000! 
     328 00001440     4c03          MOVE    A0,A3
     329 00001450     4c40          MOVE    A2,A0
     330 00001460     0d5f          CALLA   DELPAL
         00001470 00000000! 
     331 00001490     b062          MOVE    A3,*A2(OPAL),W
         000014a0     0160  
     332 000014b0           CNEWPLCT
     333 000014b0     3dc6          DSJS    A6,CNEWPLP
     334 000014c0           CNEWPALX
     335 000014c0     09af          MMFM    SP,A0,A2,A3,A6,A14
         000014d0     404d  
     336 000014e0     0960          RETS
     337                    
     338                    **************************************************************************
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE    9

     339                    *                                                                        *
     340                    * CARYZVEL - STUFF THE VEHICLE AND ALL IT'S PARTS WITH A Y/Z VEL.        *
     341                    * A1 = NEW VELOCITY                                                      *
     342                    * A8 = PTR TO DRIVER                                                     *
     343                    * A10 = PTR TO CAR                                                       *
     344                    * A13 = PTR TO PROC BLOCK                                                *
     345                    *                                                                        *
     346                    **************************************************************************
     347 000014f0           CARYZVEL
     348 000014f0     098f          MMTM    SP,A0,A6,A13
         00001500     8204  
     349                    
     350 00001510     b22a          MOVE    A1,*A10(OYVEL),L
         00001520     0060  
     351 00001530     b22a          MOVE    A1,*A10(OZVEL),L
         00001540     00e0  
     352                    
     353 00001550     4d00          MOVE    A8,A0
     354 00001560     ca04          JRZ     CADYZV3
     355 00001570     b220          MOVE    A1,*A0(OYVEL),L
         00001580     0060  
     356 00001590     b220          MOVE    A1,*A0(OZVEL),L
         000015a0     00e0  
     357 000015b0           CADYZV3
     358                    
     359 000015b0     0b0d          ADDI    ETEMP1,A13
         000015c0     0180  
     360 000015d0     1906          MOVK    NPARTS,A6
     361 000015e0           CADYZV1
     362 000015e0     97a0          MOVE    *A13+,A0,L
     363 000015f0     ca04          JRZ     CADYZV2
     364 00001600     b220          MOVE    A1,*A0(OYVEL),L
         00001610     0060  
     365 00001620     b220          MOVE    A1,*A0(OZVEL),L
         00001630     00e0  
     366 00001640           CADYZV2
     367 00001640     3ce6          DSJS    A6,CADYZV1
     368                    
     369                    ***     MOVE    *A10(OSHAD),A0,L
     370                    ***     JRZ     CADYZV4
     371                    ***     MOVE    A1,*A0(OYVEL),L
     372                    ***     MOVE    A1,*A0(OZVEL),L
     373                    ***CADYZV4
     374                    
     375 00001650     09af          MMFM    SP,A0,A6,A13
         00001660     2041  
     376 00001670     0960          RETS
     377                    
     378                    **************************************************************************
     379                    *                                                                        *
     380                    * CARXVEL - STUFF THE VEHICLE AND ALL IT'S PARTS WITH AN X VEL.          *
     381                    * A1 = NEW VELOCITY                                                      *
     382                    * A8 = PTR TO DRIVER                                                     *
     383                    * A10 = PTR TO CAR                                                       *
     384                    * A13 = PTR TO PROC BLOCK                                                *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   10

     385                    *                                                                        *
     386                    **************************************************************************
     387 00001680           CARXVEL
     388 00001680     098f          MMTM    SP,A0,A6,A13
         00001690     8204  
     389                    
     390 000016a0     0b0d          ADDI    ETEMP1,A13
         000016b0     0180  
     391 000016c0     1906          MOVK    NPARTS,A6
     392 000016d0           CADXV1
     393 000016d0     97a0          MOVE    *A13+,A0,L
     394 000016e0     ca02          JRZ     CADXV2
     395 000016f0     b220          MOVE    A1,*A0(OXVEL),L
         00001700     0040  
     396 00001710           CADXV2
     397 00001710     3ca6          DSJS    A6,CADXV1
     398                    
     399 00001720     4d00          MOVE    A8,A0
     400 00001730     ca02          JRZ     CADXV3
     401 00001740     b220          MOVE    A1,*A0(OXVEL),L
         00001750     0040  
     402 00001760           CADXV3
     403 00001760     b22a          MOVE    A1,*A10(OXVEL),L
         00001770     0040  
     404                    ***     MOVE    *A10(OSHAD),A0,L
     405                    ***     JRZ     CADXV4
     406                    ***     MOVE    A1,*A0(OXVEL),L
     407                    ***CADXV4
     408 00001780     09af          MMFM    SP,A0,A6,A13
         00001790     2041  
     409 000017a0     0960          RETS
     410                    
     411                    **************************************************************************
     412                    *                                                                        *
     413                    * CARYVEL - STUFF THE VEHICLE AND ALL IT'S PARTS WITH A Y VEL.           *
     414                    * A1 = NEW VELOCITY                                                      *
     415                    * A8 = PTR TO DRIVER                                                     *
     416                    * A10 = PTR TO CAR                                                       *
     417                    * A13 = PTR TO PROC BLOCK                                                *
     418                    *                                                                        *
     419                    **************************************************************************
     420 000017b0           CARYVEL
     421 000017b0     098f          MMTM    SP,A0,A6,A13
         000017c0     8204  
     422 000017d0     0b0d          ADDI    ETEMP1,A13
         000017e0     0180  
     423 000017f0     1906          MOVK    NPARTS,A6
     424 00001800           CADYV1
     425 00001800     97a0          MOVE    *A13+,A0,L
     426 00001810     ca02          JRZ     CADYV2
     427 00001820     b220          MOVE    A1,*A0(OYVEL),L
         00001830     0060  
     428 00001840           CADYV2
     429 00001840     3ca6          DSJS    A6,CADYV1
     430 00001850     4d00          MOVE    A8,A0
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   11

     431 00001860     ca02          JRZ     CADYV3
     432 00001870     b220          MOVE    A1,*A0(OYVEL),L
         00001880     0060  
     433 00001890           CADYV3
     434 00001890     b22a          MOVE    A1,*A10(OYVEL),L
         000018a0     0060  
     435 000018b0     09af          MMFM    SP,A0,A6,A13
         000018c0     2041  
     436 000018d0     0960          RETS
     437                    
     438                    **************************************************************************
     439                    *                                                                        *
     440                    * CARZVEL - STUFF THE VEHICLE AND ALL IT'S PARTS WITH A Z VEL.           *
     441                    * A1 = NEW VELOCITY                                                      *
     442                    * A8 = PTR TO DRIVER                                                     *
     443                    * A10 = PTR TO CAR                                                       *
     444                    * A13 = PTR TO PROC BLOCK                                                *
     445                    *                                                                        *
     446                    **************************************************************************
     447 000018e0           CARZVEL
     448 000018e0     098f          MMTM    SP,A0,A6,A13
         000018f0     8204  
     449 00001900     0b0d          ADDI    ETEMP1,A13
         00001910     0180  
     450 00001920     1906          MOVK    NPARTS,A6
     451 00001930           CADZV1
     452 00001930     97a0          MOVE    *A13+,A0,L
     453 00001940     ca02          JRZ     CADZV2
     454 00001950     b220          MOVE    A1,*A0(OZVEL),L
         00001960     00e0  
     455 00001970           CADZV2
     456 00001970     3ca6          DSJS    A6,CADZV1
     457 00001980     4d00          MOVE    A8,A0
     458 00001990     ca02          JRZ     CADZV3
     459 000019a0     b220          MOVE    A1,*A0(OZVEL),L
         000019b0     00e0  
     460 000019c0           CADZV3
     461 000019c0     b22a          MOVE    A1,*A10(OZVEL),L
         000019d0     00e0  
     462 000019e0     b740          MOVE    *A10(OSHAD),A0,L
         000019f0     0240  
     463 00001a00     ca04          JRZ     CADZV4
     464 00001a10     b220          MOVE    A1,*A0(OYVEL),L
         00001a20     0060  
     465 00001a30     b220          MOVE    A1,*A0(OZVEL),L
         00001a40     00e0  
     466 00001a50           CADZV4
     467 00001a50     09af          MMFM    SP,A0,A6,A13
         00001a60     2041  
     468 00001a70     0960          RETS
     469                    
     470                    **************************************************************************
     471                    *                                                                        *
     472                    * CARSTOP - STOP A VEHICLE AND ALL IT'S PARTS, TAKES CARE OF KILLING     *
     473                    *         THE WHEEL SPINNERS                                             *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   12

     474                    * A8 = PTR TO DRIVER                                                     *
     475                    * A10 = PTR TO VEHICLE                                                   *
     476                    * A13 = PTR TO PROC BLOCK                                                *
     477                    *                                                                        *
     478                    **************************************************************************
     479 00001a80           CARSTOP
     480 00001a80                   PUSH    A1
     481 00001a90     0d3f          CALLR   KILLCARP                ;IN CASE THERE'S ANY
         00001aa0     00a0  
     482 00001ab0     5621          CLR     A1
     483 00001ac0     0d3f          CALLR   CARYZVEL
         00001ad0     ffa1  
     484 00001ae0     0d3f          CALLR   CARXVEL
         00001af0     ffb8  
     485 00001b00     0d3f          CALLR   CWHLSTOP                ;STOP THE WHEEL PROCS
         00001b10     0080  
     486 00001b20                   PULL    A1
     487 00001b40     0960          RETS
     488                    
     489                    **************************************************************************
     490                    *                                                                        *
     491                    * CXACCEL - START VEHICLE X ACCELERATION PROCESS. IT WILL                *
     492                    *         TAKE CARE OF FLIPPED VEHICLES                                  *
     493                    * A8 = PTR TO DRIVER                                                     *
     494                    * A9 = ABS(ACCELERATION FACTOR/TICK), 32 BITS                            *
     495                    * A10 = PTR TO VEHICLE                                                   *
     496                    * A11 = ABS(TERMINAL VELOCITY), 32 BITS                                  *
     497                    * A13 = PTR TO CAR PROCESS                                               *
     498                    * RETURNS:                                                               *
     499                    * A0 = PTR TO PROC. (= 0 IF FAILED)                                      *
     500                    * A9 = VALUE PASSED                                                      *
     501                    * A11 = VALUE PASSED                                                     *
     502                    * Z BIT SET IF IT FAILED                                                 *
     503                    *                                                                        *
     504                    **************************************************************************
     505 00001b50           CXACCEL
     506 00001b50     098f          MMTM    SP,A1,A7
         00001b60     4100  
     507 00001b70     b541          MOVE    *A10(OFLAGS),A1,W       
         00001b80     0100  
     508 00001b90     1f61          BTST    B_FLIPH,A1
     509 00001ba0     ca02          JREQ    CACCEL1
     510 00001bb0     03ab          NEG     A11
     511 00001bc0     03a9          NEG     A9
     512 00001bd0           CACCEL1
     513 00001bd0     0d3f          CALLR   KILLCARP
         00001be0     008c  
     514 00001bf0                   CREATE  INDPID,CXAPRIM
     515 00001c70     ca02          JRZ     CACCELX
     516 00001c80     b3a0          MOVE    A13,*A0(PDATA),L
         00001c90     0060  
     517 00001ca0           CACCELX
     518 00001ca0     b20d          MOVE    A0,*A13(ETEMP),L
         00001cb0     0060  
     519 00001cc0     09af          MMFM    SP,A1,A7
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   13

         00001cd0     0082  
     520 00001ce0     0960          RETS
     521                    **************************************************************************
     522                    *                                                                        *
     523                    * CXACCELA - START VEHICLE X ACCELERATION PROCESS WITH ABSOLUTE VALUES.  *
     524                    *          THE VELOCITIES ARE TAKEN LITERALLY, NO CORRECTION FOR FLIP.   *
     525                    * ALL PARAMETERS ARE THE SAME AS CXACCEL.                                *
     526                    *                                                                        *
     527                    **************************************************************************
     528 00001cf0           CXACCELA
     529 00001cf0     098f          MMTM    SP,A1,A7
         00001d00     4100  
     530 00001d10     c0eb          JRUC    CACCEL1
     531                    **************************************************************************
     532                    *                                                                        *
     533                    * CXACCELB - START VEHICLE X ACCELERATION BRAKING PROCESS, NO CORRECTION *
     534                    * SAME PARAMETERS AS CXACCEL                                             *
     535                    *                                                                        *
     536                    **************************************************************************
     537 00001d20           CXACCELB
     538 00001d20     098f          MMTM    SP,A1,A7
         00001d30     4100  
     539 00001d40     0d3f          CALLR   KILLCARP
         00001d50     0075  
     540 00001d60                   CREATE  INDPID,CXAPRIMB
     541 00001de0     caeb          JRZ     CACCELX
     542 00001df0     b3a0          MOVE    A13,*A0(PDATA),L
         00001e00     0060  
     543 00001e10     c0e8          JRUC    CACCELX
     544                    
     545                    **************************************************************************
     546                    *                                                                        *
     547                    * CXAPRIM - PROCESS TO ACCELERATE A VEHICLE BY SOME CONSTANT.            *
     548                    * A8 = PTR TO DRIVER                                                     *
     549                    * A9 = ACCELERATION FACTOR/TICK                                          *
     550                    * A10 = PTR TO VEHICLE                                                   *
     551                    * A11 = TERMINAL VELOCITY, 32 BITS                                       *
     552                    * *A13(PDATA) = PTR TO VEHICLE CONTROL PROCESS                           *
     553                    *                                                                        *
     554                    **************************************************************************
     555 00001e20           CXAPRIM
     556 00001e20     b741          MOVE    *A10(OXVEL),A1,L
         00001e30     0040  
     557 00001e40     4121          ADD     A9,A1
     558 00001e50     4f62          MOVE    A11,B2
     559 00001e60     4e21          MOVE    A1,B1
     560 00001e70     4432          SUB     B1,B2
     561 00001e80     4f21          MOVE    A9,B1
     562 00001e90     0391          ABS     B1
     563 00001ea0     0392          ABS     B2
     564 00001eb0     4832          CMP     B1,B2
     565 00001ec0     c610          JRLE    CXAPRIMX
     566 00001ed0     4fa0          MOVE    A13,B0
     567 00001ee0     b7ad          MOVE    *A13(PDATA),A13,L
         00001ef0     0060  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   14

     568 00001f00     0d3f          CALLR   CARXVEL
         00001f10     ff76  
     569 00001f20     4dae          MOVE    A13,A14
     570 00001f30     4e1d          MOVE    B0,A13
     571 00001f40     0d3f          CALLR   CWHLSPDS                ;ADJUST WHEEL SPEED
         00001f50     02c6  
     572 00001f60                   SLOOP   1,CXAPRIM
     573 00001fd0           CXAPRIMX
     574 00001fd0     4d61          MOVE    A11,A1
     575 00001fe0     4fa0          MOVE    A13,B0
     576 00001ff0     b7ad          MOVE    *A13(PDATA),A13,L
         00002000     0060  
     577 00002010     0d3f          CALLR   CARXVEL
         00002020     ff65  
     578 00002030     5621          CLR     A1
     579 00002040     b22d          MOVE    A1,*A13(ETEMP),L
         00002050     0060  
     580 00002060     4dae          MOVE    A13,A14
     581 00002070     4e1d          MOVE    B0,A13
     582 00002080     0d3f          CALLR   CWHLSPDS                ;ADJUST WHEEL SPEED
         00002090     02b2  
     583 000020a0                   DIE
     584                    
     585                    
     586                    **************************************************************************
     587                    *                                                                        *
     588                    * CXAPRIMB - PROCESS TO ACCELERATE A VEHICLE BY SOME CONSTANT.           *
     589                    *            WHEEL SPEED IS NOT UPDATED HERE.                            *
     590                    * A8 = PTR TO DRIVER                                                     *
     591                    * A9 = ACCELERATION FACTOR/TICK                                          *
     592                    * A10 = PTR TO VEHICLE                                                   *
     593                    * A11 = TERMINAL VELOCITY, 32 BITS                                       *
     594                    * *A13(PDATA) = PTR TO VEHICLE CONTROL PROCESS                           *
     595                    *                                                                        *
     596                    **************************************************************************
     597 000020d0           CXAPRIMB
     598 000020d0     b741          MOVE    *A10(OXVEL),A1,L
         000020e0     0040  
     599 000020f0     4121          ADD     A9,A1
     600 00002100     4f62          MOVE    A11,B2
     601 00002110     4e21          MOVE    A1,B1
     602 00002120     4432          SUB     B1,B2
     603 00002130     4f21          MOVE    A9,B1
     604 00002140     0391          ABS     B1
     605 00002150     0392          ABS     B2
     606 00002160     4832          CMP     B1,B2
     607 00002170     c60d          JRLE    CXBPRIMX
     608 00002180     4fa0          MOVE    A13,B0
     609 00002190     b7ad          MOVE    *A13(PDATA),A13,L
         000021a0     0060  
     610 000021b0     0d3f          CALLR   CARXVEL
         000021c0     ff4b  
     611 000021d0     4e1d          MOVE    B0,A13
     612 000021e0                   SLOOP   1,CXAPRIMB
     613 00002250           CXBPRIMX
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   15

     614 00002250     4d61          MOVE    A11,A1
     615 00002260     4fa0          MOVE    A13,B0
     616 00002270     b7ad          MOVE    *A13(PDATA),A13,L
         00002280     0060  
     617 00002290     0d3f          CALLR   CARXVEL
         000022a0     ff3d  
     618 000022b0     5621          CLR     A1
     619 000022c0     b22d          MOVE    A1,*A13(ETEMP),L
         000022d0     0060  
     620 000022e0     4e1d          MOVE    B0,A13
     621 000022f0                   DIE
     622                    
     623                    **************************************************************************
     624                    *                                                                        *
     625                    * CWHLSTOP - KILL A VEHICLES WHEEL SPINNING PROCS IF THEY EXIST.         *
     626                    * A8 = PTR TO DRIVER                                                     *
     627                    * A10 = PTR TO VEHICLE MAIN                                              *
     628                    * A13 = PTR TO VEHICLE PROCESS                                           *
     629                    *                                                                        *
     630                    **************************************************************************
     631 00002320           CWHLSTOP
     632 00002320     098f          MMTM    SP,A0,A8,A11
         00002330     8090  
     633 00002340     576b          CLR     A11
     634 00002350     03eb          NOT     A11
     635 00002360     b7a8          MOVE    *A13(ETEMP3),A8,L       ;DO FRONT WHEEL
         00002370     01c0  
     636 00002380     ca06          JRZ     CWHLSTP1                ;BR = NO OBJECT FOR THAT
     637 00002390     b700          MOVE    *A8(OPLINK),A0,L
         000023a0     01f0  
     638 000023b0     ca03          JRZ     CWHLSTP1                ;BR = NO SPINNING PROCESS
     639 000023c0     0d5f          CALLA   PUTA11
         000023d0 00000000! 
     640 000023f0           CWHLSTP1
     641 000023f0     b7a8          MOVE    *A13(ETEMP4),A8,L       ;REAR WHEEL
         00002400     01e0  
     642 00002410     ca06          JRZ     CWHLSTP2                ;BR = NO OBJECT
     643 00002420     b700          MOVE    *A8(OPLINK),A0,L
         00002430     01f0  
     644 00002440     ca03          JRZ     CWHLSTP2                ;BR = NO SPINNING PROC.
     645 00002450     0d5f          CALLA   PUTA11
         00002460 00000000! 
     646 00002480           CWHLSTP2
     647 00002480     09af          MMFM    SP,A0,A8,A11
         00002490     0901  
     648 000024a0     0960          RETS
     649                    **************************************************************************
     650                    *                                                                        *
     651                    * KILLCARP - KILL THE MAIN VEHICLE BODY PROCESS, USUALLY ACCEL, AND      *
     652                    *          DECEL PROCS.                                                  *
     653                    * A8 = PTR TO DRIVER                                                     *
     654                    * A10 = PTR TO CAR                                                       *
     655                    * A13 = PTR TO PROCBLOC                                                  *
     656                    *                                                                        *
     657                    **************************************************************************
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   16

     658 000024b0           KILLCARP
     659 000024b0                   PUSH    A0
     660 000024c0     b7a0          MOVE    *A13(ETEMP),A0,L
         000024d0     0060  
     661 000024e0     ca06          JRZ     KILLCRPX
     662 000024f0     0d5f          CALLA   KILL
         00002500 00000000! 
     663 00002520     5600          CLR     A0
     664 00002530     b20d          MOVE    A0,*A13(ETEMP),L
         00002540     0060  
     665 00002550           KILLCRPX
     666 00002550                   PULL    A0
     667 00002570     0960          RETS
     668                    
     669                    **************************************************************************
     670                    *                                                                        *
     671                    * CFLIPART - SET THE FLIP BITS OF ALL CAR PARTS ACCORDING TO             *
     672                    *          THE MAIN BODY. THIS INCLUDES THE DRIVER.                      *
     673                    * A8 = PTR TO DRIVER                                                     *
     674                    * A10 = PTR TO THE VEHICLE                                               *
     675                    * A13 = PTR TO PROC BLOCK                                                *
     676                    *                                                                        *
     677                    **************************************************************************
     678 00002580           CFLIPART
     679 00002580     098f          MMTM    SP,A0,A1,A4,A8,A13
         00002590     c884  
     680 000025a0     b544          MOVE    *A10(OFLAGS),A4,W
         000025b0     0100  
     681 000025c0     4d00          MOVE    A8,A0
     682 000025d0     4d48          MOVE    A10,A8
     683 000025e0     0d5f          CALLA   GETANIXY
         000025f0 00000000! 
     684 00002610     4e42          MOVE    A2,B2
     685 00002620     4e63          MOVE    A3,B3
     686 00002630                   TEST    A0
     687 00002640     ca03          JRZ     CFLIPP1
     688 00002650     0d5f          CALLA   GANISAG                 ;RE-ADJUST DRIVER
         00002660 00000000! 
     689 00002680           CFLIPP1
     690 00002680     0b0d          ADDI    ETEMP1,A13
         00002690     0180  
     691 000026a0     1906          MOVK    NPARTS,A6
     692 000026b0           CFLIPP2
     693 000026b0     97a0          MOVE    *A13+,A0,L
     694 000026c0     ca05          JRZ     CFLIPP3
     695 000026d0     4e52          MOVE    B2,A2
     696 000026e0     4e73          MOVE    B3,A3
     697 000026f0     0d5f          CALLA   GANISAG                 ;RE-ADJUST PARTS
         00002700 00000000! 
     698 00002720           CFLIPP3
     699 00002720     3d06          DSJS    A6,CFLIPP2
     700 00002730     09af          MMFM    SP,A0,A1,A4,A8,A13
         00002740     2113  
     701 00002750     0960          RETS
     702                    
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   17

     703                    **************************************************************************
     704                    *                                                                        *
     705                    * CARTNKO - OPEN THE VEHICLES TRUNK, DOORS, ETC.                         *
     706                    * A13 = PTR TO PROC BLOCK                                                *
     707                    * NOTE: CALL WITH JSRP                                                   *
     708                    *                                                                        *
     709                    **************************************************************************
     710 00002760           CARTNKO
     711 00002760     098c          MMTM    A12,A9,A11
         00002770     0050  
     712 00002780     b7ab          MOVE    *A13(ETEMP2),A11,L
         00002790     01a0  
     713 000027a0     ca1c          JRZ     CARTNKOX
     714 000027b0     b7a6          MOVE    *A13(EMAINT),A6,L
         000027c0     0100  
     715 000027d0     1ac0          MOVK    TRUNKOP,A0
     716 000027e0     0d5f          CALLA   GSCRIPT
         000027f0 00000000! 
     717 00002810           CARTNKO1
     718 00002810                   SWAP    A8,A11
     719 00002840     1881          MOVK    4,A1
     720 00002850                   JSRP    FRANIM
     721 000028c0                   SWAP    A8,A11
     722 000028f0     c807          JRC     CARTNKOX
     723 00002900                   SLOOPR  A0,CARTNKO1             ;LOOP SLEEP ON REGISTER
     724 00002970           CARTNKOX
     725 00002970     09ac          MMFM    A12,A9,A11
         00002980     0a00  
     726 00002990                   RETP
     727                    
     728                    **************************************************************************
     729                    *                                                                        *
     730                    * CARTNKC - CLOZ THE VEHICLES TRUNK, DOORS, ETC.                         *
     731                    * A13 = PTR TO PROC BLOCK                                                *
     732                    * NOTE: CALL WITH JSRP                                                   *
     733                    *                                                                        *
     734                    **************************************************************************
     735 000029c0           CARTNKC
     736 000029c0     098c          MMTM    A12,A9,A11
         000029d0     0050  
     737 000029e0     b7ab          MOVE    *A13(ETEMP2),A11,L
         000029f0     01a0  
     738 00002a00     ca1c          JRZ     CARTNKCX
     739 00002a10     b7a6          MOVE    *A13(EMAINT),A6,L
         00002a20     0100  
     740 00002a30     1ae0          MOVK    TRUNKCL,A0
     741 00002a40     0d5f          CALLA   GSCRIPT
         00002a50 00000000! 
     742 00002a70           CARTNKC1
     743 00002a70                   SWAP    A8,A11
     744 00002aa0     1881          MOVK    4,A1
     745 00002ab0                   JSRP    FRANIM
     746 00002b20                   SWAP    A8,A11
     747 00002b50     c807          JRC     CARTNKCX
     748 00002b60                   SLOOPR  A0,CARTNKC1
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   18

     749 00002bd0           CARTNKCX
     750 00002bd0     09ac          MMFM    A12,A9,A11
         00002be0     0a00  
     751 00002bf0                   RETP
     752                    
     753                    **************************************************************************
     754                    *                                                                        *
     755                    * CRTURN - CADILLAC TURN RIGHT PLEASE                                    *
     756                    * A8 = PTR TO DRIVER                                                     *
     757                    * A10 = PTR TO BODY                                                      *
     758                    * A13 = PTR TO MASSIVE AUTO DATA STRUCTURE, SEE CADDY FOR DETAILS.       *
     759                    * RETURNS:                                                               *
     760                    * A9 = POINTING TO THE WORD AFTER THE LAST PROCESSED ANIMATION SCRIPT    *
     761                    * NOTE: CALL WITH JSRP                                                   *
     762                    *                                                                        *
     763                    **************************************************************************
     764 00002c20           CRTURN
     765 00002c20                   PUSHP   A11
     766 00002c30     4f00          MOVE    A8,B0
     767 00002c40     b7a8          MOVE    *A13(ETEMP3),A8,L       ;HANDLE FRONT WHEELS    
         00002c50     01c0  
     768 00002c60     ca21          JRZ     CRTURN2
     769 00002c70     b7a6          MOVE    *A13(EMAINT),A6,L
         00002c80     0100  
     770 00002c90     0d3f          CALLR   ISREVERS                ;IS, IS, IS IT REVERSED
         00002ca0     02d4  
     771 00002cb0     c802          JRC     CRTURN0
     772 00002cc0     1aa0          MOVK    WHEELR,A0
     773 00002cd0     c001          JRUC    CRTURN0A
     774 00002ce0           CRTURN0
     775 00002ce0     1be0          MOVK    WHEELRR,A0
     776 00002cf0           CRTURN0A
     777 00002cf0     0d5f          CALLA   GSCRIPT
         00002d00 00000000! 
     778 00002d20     b700          MOVE    *A8(OPLINK),A0,L
         00002d30     01f0  
     779 00002d40     ca0b          JRZ     CRTURN1
     780 00002d50     4f21          MOVE    A9,B1
     781 00002d60     0d3f          CALLR   ANIMATCH
         00002d70     02d9  
     782 00002d80     ca0f          JRZ     CRTURN2                 ;NO NEED TO CHANGE
     783 00002d90     0d5f          CALLA   GETA11
         00002da0 00000000! 
     784 00002dc0     cf0b          JRNN    CRTURN2                 ;T'WILL ANIMATE ITSELF IN
     785 00002dd0     8721          MOVE    *A9,A1,L
     786 00002de0     cb01          JRNZ    CRTURN1                 ;O.K. TO ANIMATE CURRENT FRAME
     787 00002df0     4e39          MOVE    B1,A9
     788 00002e00           CRTURN1
     789 00002e00     1881          MOVK    4,A1
     790 00002e10                   JSRP    FRANIM                  ;JUST STUFF THE NEW FRAME
     791 00002e80           CRTURN2
     792 00002e80     4e18          MOVE    B0,A8
     793 00002e90     ca15          JRZ     CRTURNX                 ;BR = NO DRIVER TO BEGIN WITH
     794 00002ea0     b7a6          MOVE    *A13(EMAINT),A6,L
         00002eb0     0100  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   19

     795 00002ec0     1a00          MOVK    DRIVRYTE,A0
     796 00002ed0     0d5f          CALLA   GSCRIPT                 ;GET US A SCRIPT
         00002ee0 00000000! 
     797 00002f00           CRTURN3
     798 00002f00     b7a0          MOVE    *A13(EFLAGS),A0,L
         00002f10     0080  
     799 00002f20     1de0          BTST    BDIE,A0
     800 00002f30     cb0b          JRNE    CRTURNX                 ;BR = THE DRIVER IS DEAD
     801 00002f40     5621          CLR     A1
     802 00002f50                   JSRP    FRANIM
     803 00002fc0     c802          JRC     CRTURNX
     804 00002fd0     4d08          MOVE    A8,A8
     805 00002fe0     cbf1          JRNZ    CRTURN3
     806 00002ff0           CRTURNX
     807 00002ff0                   PULLP   A11
     808 00003010                   RETP    
     809                    
     810                    **************************************************************************
     811                    *                                                                        *
     812                    * CLTURN - CADILLAC TURN LEFT PLEASE                                     *
     813                    * A8 = PTR TO DRIVER                                                     *
     814                    * A10 = PTR TO BODY                                                      *
     815                    * A13 = PTR TO MASSIVE AUTO DATA STRUCTURE, SEE CADDY FOR DETAILS.       *
     816                    * RETURNS:                                                               *
     817                    * A9 = POINTING TO THE WORD AFTER THE LAST PROCESSED ANIMATION SCRIPT    *
     818                    * NOTE: CALL WITH JSRP                                                   *
     819                    *                                                                        *
     820                    **************************************************************************
     821 00003040           CLTURN
     822 00003040                   PUSHP   A11
     823 00003050     4f00          MOVE    A8,B0
     824 00003060     b7a8          MOVE    *A13(ETEMP3),A8,L       ;HANDLE FRONT WHEELS    
         00003070     01c0  
     825 00003080     ca21          JRZ     CLTURN2
     826 00003090     b7a6          MOVE    *A13(EMAINT),A6,L
         000030a0     0100  
     827 000030b0     0d3f          CALLR   ISREVERS                ;IS, IS, IS IT REVERSED
         000030c0     0292  
     828 000030d0     c802          JRC     CLTURN0
     829 000030e0     1a80          MOVK    WHEELL,A0
     830 000030f0     c001          JRUC    CLTURN0A
     831 00003100           CLTURN0
     832 00003100     1bc0          MOVK    WHEELLR,A0
     833 00003110           CLTURN0A
     834 00003110     0d5f          CALLA   GSCRIPT
         00003120 00000000! 
     835 00003140     b700          MOVE    *A8(OPLINK),A0,L
         00003150     01f0  
     836 00003160     ca0b          JRZ     CLTURN1
     837 00003170     4f21          MOVE    A9,B1
     838 00003180     0d3f          CALLR   ANIMATCH
         00003190     0297  
     839 000031a0     ca0f          JRZ     CLTURN2                 ;NO NEED TO CHANGE
     840 000031b0     0d5f          CALLA   GETA11
         000031c0 00000000! 
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   20

     841 000031e0     cf0b          JRNN    CLTURN2                 ;ANIMATE YOUR HOLE
     842 000031f0     8721          MOVE    *A9,A1,L
     843 00003200     cb01          JRNZ    CLTURN1
     844 00003210     4e39          MOVE    B1,A9
     845 00003220           CLTURN1
     846 00003220     1881          MOVK    4,A1
     847 00003230                   JSRP    FRANIM                  ;JUST STUFF THE NEW FRAME
     848 000032a0           CLTURN2
     849 000032a0     4e18          MOVE    B0,A8
     850 000032b0     ca15          JRZ     CLTURNX                 ;BR = NO DRIVER
     851 000032c0     b7a6          MOVE    *A13(EMAINT),A6,L
         000032d0     0100  
     852 000032e0     1a20          MOVK    DRIVLEFT,A0
     853 000032f0     0d5f          CALLA   GSCRIPT                 ;GET THE SCRIPT
         00003300 00000000! 
     854 00003320           CLTURN3
     855 00003320     b7a0          MOVE    *A13(EFLAGS),A0,L
         00003330     0080  
     856 00003340     1de0          BTST    BDIE,A0
     857 00003350     cb0b          JRNE    CLTURNX                 ;BR = THE DRIVER IS DEAD
     858 00003360     5621          CLR     A1
     859 00003370                   JSRP    FRANIM
     860 000033e0     c802          JRC     CLTURNX
     861 000033f0     4d08          MOVE    A8,A8
     862 00003400     cbf1          JRNZ    CLTURN3
     863 00003410           CLTURNX
     864 00003410                   PULLP   A11
     865 00003430           DUMRETP
     866 00003430                   RETP    
     867                    
     868                    **************************************************************************
     869                    *                                                                        *
     870                    * CSTRAYTE - CADILLAC STRAIGHT AHEAD, WARP FACTOR 1, SCOTTY              *
     871                    * A8 = PTR TO DRIVER                                                     *
     872                    * A10 = PTR TO BODY                                                      *
     873                    * A13 = PTR TO MASSIVE AUTO DATA STRUCTURE, SEE CADDY FOR DETAILS.       *
     874                    * RETURNS:                                                               *
     875                    * A9 = POINTING TO THE WORD AFTER THE LAST PROCESSED ANIMATION SCRIPT    *
     876                    * NOTE: CALL WITH JSRP, THIS ROUTINE ASSUMES THAT A9 WAS LEFT            *
     877                    *       POINTING TO THE CORRECT ANIMATION OF THE DRIVER RETURNING        *
     878                    *       TO A STRAIGHT POSITION. IF A9 = 0 THEN ANIMATE NOTHING.          *
     879                    *                                                                        *
     880                    **************************************************************************
     881 00003460           CSTRAYTE
     882 00003460                   PUSHP   A11
     883 00003470     4f00          MOVE    A8,B0
     884 00003480     4f22          MOVE    A9,B2
     885 00003490     b7a8          MOVE    *A13(ETEMP3),A8,L       ;HANDLE FRONT WHEELS    
         000034a0     01c0  
     886 000034b0     ca21          JRZ     CSTRAYT2
     887 000034c0     b7a6          MOVE    *A13(EMAINT),A6,L
         000034d0     0100  
     888 000034e0     0d3f          CALLR   ISREVERS
         000034f0     024f  
     889 00003500     c802          JRC     CSTRAY0                 ;MAKE THEM REVERSE WHEELS
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   21

     890 00003510     1a60          MOVK    FRONTWHE,A0
     891 00003520     c001          JRUC    CSTRAY0A
     892 00003530           CSTRAY0
     893 00003530     1ba0          MOVK    FRONTWR,A0
     894 00003540           CSTRAY0A
     895 00003540     0d5f          CALLA   GSCRIPT
         00003550 00000000! 
     896 00003570     b700          MOVE    *A8(OPLINK),A0,L
         00003580     01f0  
     897 00003590     ca0b          JRZ     CSTRAYT1
     898 000035a0     4f21          MOVE    A9,B1
     899 000035b0     0d3f          CALLR   ANIMATCH
         000035c0     0254  
     900 000035d0     ca0f          JRZ     CSTRAYT2                ;NO NEED TO CHANGE
     901 000035e0     0d5f          CALLA   GETA11                  ;CHECK ANIMATION TIME
         000035f0 00000000! 
     902 00003610     cf0b          JRNN    CSTRAYT2
     903 00003620     8721          MOVE    *A9,A1,L
     904 00003630     cb01          JRNZ    CSTRAYT1
     905 00003640     4e39          MOVE    B1,A9
     906 00003650           CSTRAYT1
     907 00003650     1881          MOVK    4,A1
     908 00003660                   JSRP    FRANIM                  ;JUST STUFF THE NEW FRAME
     909 000036d0           CSTRAYT2
     910 000036d0     4e18          MOVE    B0,A8
     911 000036e0     ca11          JRZ     CSTRAYX
     912 000036f0     4e59          MOVE    B2,A9
     913 00003700     ca0f          JRZ     CSTRAYX
     914 00003710           CSTRAYT3
     915 00003710     b7a0          MOVE    *A13(EFLAGS),A0,L
         00003720     0080  
     916 00003730     1de0          BTST    BDIE,A0
     917 00003740     cb0b          JRNE    CSTRAYX         ;BR = THE DRIVER IS DEAD
     918 00003750     5621          CLR     A1
     919 00003760                   JSRP    FRANIM
     920 000037d0     c802          JRC     CSTRAYX
     921 000037e0     4d08          MOVE    A8,A8
     922 000037f0     cbf1          JRNZ    CSTRAYT3
     923 00003800           CSTRAYX
     924 00003800                   PULLP   A11
     925 00003820                   RETP    
     926                    
     927                    
     928                    **************************************************************************
     929                    *                                                                        *
     930                    * WHLSTR - VEHICLE WHEELS POINTED STRAIGHT AHEAD                         *
     931                    * A8 = PTR TO DRIVER                                                     *
     932                    * A10 = PTR TO BODY                                                      *
     933                    * A13 = PTR TO MASSIVE AUTO DATA STRUCTURE, SEE CADDY FOR DETAILS.       *
     934                    * RETURNS:                                                               *
     935                    * A9 = POINTING TO THE WORD AFTER THE LAST PROCESSED ANIMATION SCRIPT    *
     936                    *                                                                        *
     937                    **************************************************************************
     938 00003850           WHLSTR
     939 00003850     098f          MMTM    SP,A8,A11
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   22

         00003860     0090  
     940 00003870     b7a8          MOVE    *A13(ETEMP3),A8,L       ;HANDLE FRONT WHEELS    
         00003880     01c0  
     941 00003890     ca21          JRZ     WHLSTRX
     942 000038a0     b7a6          MOVE    *A13(EMAINT),A6,L
         000038b0     0100  
     943 000038c0     0d3f          CALLR   ISREVERS
         000038d0     0211  
     944 000038e0     c802          JRC     WHLSTR0
     945 000038f0     1a60          MOVK    FRONTWHE,A0
     946 00003900     c001          JRUC    WHLSTR0A
     947 00003910           WHLSTR0
     948 00003910     1ba0          MOVK    FRONTWR,A0
     949 00003920           WHLSTR0A
     950 00003920     0d5f          CALLA   GSCRIPT
         00003930 00000000! 
     951 00003950     b700          MOVE    *A8(OPLINK),A0,L
         00003960     01f0  
     952 00003970     ca0b          JRZ     WHLSTR1
     953 00003980     4f21          MOVE    A9,B1
     954 00003990     0d3f          CALLR   ANIMATCH
         000039a0     0216  
     955 000039b0     ca0f          JRZ     WHLSTRX                 ;NO NEED TO CHANGE
     956 000039c0     0d5f          CALLA   GETA11
         000039d0 00000000! 
     957 000039f0     cf0b          JRNN    WHLSTRX                 ;BR = "AUTOMATIC" ANIMATION
     958 00003a00     8721          MOVE    *A9,A1,L
     959 00003a10     cb01          JRNZ    WHLSTR1
     960 00003a20     4e39          MOVE    B1,A9                   ;RESET TO TOP
     961 00003a30           WHLSTR1
     962 00003a30     1881          MOVK    4,A1
     963 00003a40                   JSRP    FRANIM                  ;JUST STUFF THE NEW FRAME
     964 00003ab0           WHLSTRX
     965 00003ab0     09af          MMFM    SP,A8,A11
         00003ac0     0900  
     966 00003ad0     0960          RETS    
     967                    
     968                    **************************************************************************
     969                    *                                                                        *
     970                    * CR180PRM - SPIN THE VEHICLE 180 DEGREES RIGHT PRIMITIVE.               *
     971                    * A8 = PTR TO DRIVER                                                     *
     972                    * A10 = PTR TO VEHICLE MAIN                                              *
     973                    * A13 = PTR TO PROC BLOCK                                                *
     974                    * NOTE: CALL WITH JSRP                                                   *
     975                    *                                                                        *
     976                    **************************************************************************
     977 00003ae0           CR180PRM
     978 00003ae0     b7a6          MOVE    *A13(EMAINT),A6,L
         00003af0     0100  
     979 00003b00     b541          MOVE    *A10(OFLAGS),A1,W
         00003b10     0100  
     980 00003b20     1f61          BTST    B_FLIPH,A1
     981 00003b30     cb02          JRNE    CRYTE181        ;BR = HE'S FLIPPED OUT
     982 00003b40     1b00          MOVK    SPINFOR,A0
     983 00003b50     c00b          JRUC    CR1800
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   23

     984 00003b60           CRYTE181
     985 00003b60     1b20          MOVK    SPINFORF,A0
     986 00003b70     c009          JRUC    CR1800
     987                    *CL180PRM - SAME AS CR180PRM BUT IN THE OPPOSITE DIRECTION
     988 00003b80           CL180PRM
     989 00003b80     b7a6          MOVE    *A13(EMAINT),A6,L
         00003b90     0100  
     990 00003ba0     b541          MOVE    *A10(OFLAGS),A1,W
         00003bb0     0100  
     991 00003bc0     1f61          BTST    B_FLIPH,A1
     992 00003bd0     cb02          JRNE    CLEFT181        ;BR = HE'S FLIPPED OUT
     993 00003be0     1b40          MOVK    SPINREV,A0
     994 00003bf0     c001          JRUC    CR1800
     995 00003c00           CLEFT181
     996 00003c00     1b60          MOVK    SPINREVF,A0
     997 00003c10           CR1800
     998 00003c10     4e00          MOVE    A0,B0
     999 00003c20     4d40          MOVE    A10,A0
    1000 00003c30     0d5f          CALLA   DELSHAD         ;GET-RID-O-SHAD
         00003c40 00000000! 
    1001 00003c60     4e10          MOVE    B0,A0
    1002 00003c70     0d5f          CALLA   GSCRIPT         ;GET THE CORRECT SCRIPT
         00003c80 00000000! 
    1003 00003ca0     4d00          MOVE    A8,A0
    1004 00003cb0     ca03          JRZ     CR1801
    1005 00003cc0     0d5f          CALLA   OBJOFF
         00003cd0 00000000! 
    1006 00003cf0           CR1801
    1007 00003cf0     4dae          MOVE    A13,A14
    1008 00003d00     0b0e          ADDI    ETEMP1,A14
         00003d10     0180  
    1009 00003d20     1906          MOVK    NPARTS,A6
    1010 00003d30           CR1802
    1011 00003d30     97c0          MOVE    *A14+,A0,L
    1012 00003d40     ca03          JRZ     CR1803
    1013 00003d50     0d5f          CALLA   OBJOFF
         00003d60 00000000! 
    1014 00003d80           CR1803  
    1015 00003d80     3cc6          DSJS    A6,CR1802
    1016 00003d90           CR1805
    1017 00003d90                   SWAP    A8,A10
    1018 00003dc0     1881          MOVK    4,A1
    1019 00003dd0                   JSRP    FRANIM
    1020 00003e40                   SWAP    A10,A8
    1021 00003e70     c807          JRC     CR1805A
    1022 00003e80                   SLOOPR  A0,CR1805
    1023 00003ef0           CR1805A
    1024 00003ef0     0d3f          CALLR   CFLIPART        ;FLIP ALL OF THE CAR PARTS
         00003f00     fe67  
    1025                    
    1026 00003f10     4d00          MOVE    A8,A0
    1027 00003f20     ca03          JRZ     CR1806
    1028 00003f30     0d5f          CALLA   OBJON
         00003f40 00000000! 
    1029 00003f60           CR1806
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   24

    1030 00003f60     4dae          MOVE    A13,A14
    1031 00003f70     0b0e          ADDI    ETEMP1,A14
         00003f80     0180  
    1032 00003f90     1906          MOVK    NPARTS,A6
    1033 00003fa0           CR1807
    1034 00003fa0     97c0          MOVE    *A14+,A0,L
    1035 00003fb0     ca03          JRZ     CR1808
    1036 00003fc0     0d5f          CALLA   OBJON
         00003fd0 00000000! 
    1037 00003ff0           CR1808  
    1038 00003ff0     3cc6          DSJS    A6,CR1807
    1039 00004000     0d3f          CALLR   CSHADST
         00004010     01e5  
    1040 00004020                   RETP
    1041                    
    1042                    **************************************************************************
    1043                    *                                                                        *
    1044                    * CRYTE360 - TURN A VEHICLE 360 DEG. CLOCKWISE                           *
    1045                    * A8 = PTR TO DRIVER                                                     *
    1046                    * A10 = PTR TO CAR                                                       *
    1047                    * NOTE: CALL WITH JSRP                                                   *
    1048                    *       A9 IS THRASHED                                                   *
    1049                    *                                                                        *
    1050                    **************************************************************************
    1051 00004050           CRYTE360
    1052 00004050                   JSRP    CRTURN
    1053 000040c0                   PUSHP   A9
    1054                    
    1055 000040d0                   JSRP    CR180PRM                ;SPIN THIS DUDE
    1056 00004140                   JSRP    CL180PRM                ;SPIN THIS DUDE
    1057                    
    1058 000041b0     c016          JRUC    C360G
    1059                    *CLEFT360 - SAME AS CRYTE360 EXCEPT COUNTERCLOCKWISE
    1060 000041c0           CLEFT360
    1061 000041c0                   JSRP    CLTURN
    1062 00004230                   PUSHP   A9
    1063                    
    1064 00004240                   JSRP    CL180PRM                ;SPIN THIS DUDE
    1065 000042b0                   JSRP    CR180PRM                ;SPIN THIS DUDE
    1066 00004320           C360G
    1067 00004320                   PULLP   A9
    1068 00004340                   JSRP    CSTRAYTE
    1069 000043b0     0d3f          CALLR   CZRESET
         000043c0     00e5  
    1070 000043d0                   RETP
    1071                    
    1072                    **************************************************************************
    1073                    *                                                                        *
    1074                    * CRYTE180 - TURN A VEHICLE 180 DEG. CLOCKWISE                           *
    1075                    * A8 = PTR TO DRIVER                                                     *
    1076                    * A10 = PTR TO CAR                                                       *
    1077                    * NOTE: CALL WITH JSRP                                                   *
    1078                    *       A9 IS THRASHED                                                   *
    1079                    *                                                                        *
    1080                    **************************************************************************
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   25

    1081 00004400           CRYTE180
    1082 00004400                   JSRP    CRTURN
    1083 00004470                   PUSHP   A9
    1084 00004480                   JSRP    CR180PRM                ;SPIN THIS DUDE
    1085 000044f0     c00f          JRUC    C180G
    1086                    *CLEFT180 - SAME AS CRYTE180 EXCEPT COUNTERCLOCKWISE
    1087 00004500           CLEFT180
    1088 00004500                   JSRP    CLTURN
    1089 00004570                   PUSHP   A9
    1090 00004580                   JSRP    CL180PRM                ;SPIN THIS DUDE
    1091 000045f0           C180G
    1092 000045f0                   PULLP   A9
    1093 00004610                   JSRP    CSTRAYTE
    1094 00004680     0d3f          CALLR   CZRESET
         00004690     00b8  
    1095 000046a0                   RETP
    1096                    
    1097                    
    1098                    **************************************************************************
    1099                    *                                                                        *
    1100                    * CWHLSPD - ADJUST A VEHICLES WHEEL ANIMATION SPEED ACCORDING TO         *
    1101                    *         THE CURRENT X VELOCITY.                                        *
    1102                    * A8 = PTR TO DRIVER                                                     *
    1103                    * A10 = PTR TO VEHICLE MAIN                                              *
    1104                    * A13 = PTR TO VEHICLE PROCESS BLOCK                                     *
    1105                    *                                                                        *
    1106                    **************************************************************************
    1107 000046d0           CWHLSPD
    1108 000046d0     098f          MMTM    SP,A0,A1,A6,A7,A8,A9,A11
         000046e0     c3d0  
    1109 000046f0     b74b          MOVE    *A10(OXVEL),A11,L
         00004700     0040  
    1110 00004710     ca04          JRZ     CWHLSPDA        
    1111 00004720     2a0b          SRA     16,A11
    1112 00004730     cb07          JRNZ    CWHLSPD0
    1113 00004740     102b          INC     A11                     ;FRACTIONAL ALWAYS DOES THIS
    1114 00004750     c005          JRUC    CWHLSPD0
    1115 00004760           CWHLSPDA
    1116 00004760     0d3f          CALLR   CWHLSTOP                ;XVEL = 0, STOP THE WHEELS
         00004770     fdba  
    1117 00004780     09af          MMFM    SP,A0,A1,A6,A7,A8,A9,A11
         00004790     0bc3  
    1118 000047a0     0960          RETS
    1119 000047b0           CWHLSPD0
    1120 000047b0     b7a6          MOVE    *A13(EMAINT),A6,L
         000047c0     0100  
    1121 000047d0     09c1          MOVI    INDPID,A1       ;LOAD THESE PARAMS IN CASE WE MUST CREATE
         000047e0     0006  
    1122 000047f0     09e7          MOVI    ANIMATOR,A7     ;INDEPENDANT ANIMATION PROCESS
         00004800 00000000! 
    1123 00004820     038b          ABS     A11
    1124 00004830     150b          SUBK    8,A11
    1125 00004840     c401          JRLT    CWHLSPD1
    1126 00004850     576b          CLR     A11
    1127 00004860           CWHLSPD1
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   26

    1128 00004860     038b          ABS     A11
    1129 00004870     b7a8          MOVE    *A13(ETEMP3),A8,L
         00004880     01c0  
    1130 00004890     ca15          JRZ     CWSPD2A                 ;BR = NO FRONT WHEEL
    1131 000048a0     b700          MOVE    *A8(OPLINK),A0,L
         000048b0     01f0  
    1132 000048c0     ca04          JRZ     CWHLSPD2                ;BR = NO SPIN PROC
    1133 000048d0     0d5f          CALLA   PUTA11                  ;PUT THE TIME
         000048e0 00000000! 
    1134 00004900     c00e          JRUC    CWSPD2A
    1135 00004910           CWHLSPD2
    1136 00004910     0d3f          CALLR   ISREVERS
         00004920     010c  
    1137 00004930     c802          JRC     CWSPD1A
    1138 00004940     1a60          MOVK    FRONTWHE,A0
    1139 00004950     c001          JRUC    CWSPD1B
    1140 00004960           CWSPD1A
    1141 00004960     1ba0          MOVK    FRONTWR,A0
    1142 00004970           CWSPD1B
    1143 00004970     0d5f          CALLA   GSCRIPT
         00004980 00000000! 
    1144 000049a0     0d5f          CALLA   GETPRC                  ;START THE FRONT WHEEL SPIN PROC
         000049b0 00000000! 
    1145 000049d0     b208          MOVE    A0,*A8(OPLINK),L
         000049e0     01f0  
    1146 000049f0           CWSPD2A
    1147 000049f0     0d3f          CALLR   ISREVERS
         00004a00     00fe  
    1148 00004a10     c802          JRC     CWHLSPD4
    1149 00004a20     1a40          MOVK    REARWHEE,A0
    1150 00004a30     c001          JRUC    CWHLSPD5
    1151 00004a40           CWHLSPD4
    1152 00004a40     1b80          MOVK    REARWR,A0
    1153 00004a50           CWHLSPD5
    1154 00004a50     0d5f          CALLA   GSCRIPT
         00004a60 00000000! 
    1155 00004a80     b7a8          MOVE    *A13(ETEMP4),A8,L
         00004a90     01e0  
    1156 00004aa0     ca0e          JRZ     CWSPD3A                 ;BR = NO REAR WHEEL
    1157 00004ab0     b700          MOVE    *A8(OPLINK),A0,L
         00004ac0     01f0  
    1158 00004ad0     ca06          JRZ     CWHLSPD3
    1159 00004ae0     0d3f          CALLR   ANIMATCH
         00004af0     0101  
    1160 00004b00     0d5f          CALLA   PUTA11
         00004b10 00000000! 
    1161 00004b30     c005          JRUC    CWSPD3A
    1162 00004b40           CWHLSPD3
    1163 00004b40     0d5f          CALLA   GETPRC          ;REAR WHEEL SPIN PROC
         00004b50 00000000! 
    1164 00004b70     b208          MOVE    A0,*A8(OPLINK),L
         00004b80     01f0  
    1165 00004b90           CWSPD3A
    1166 00004b90           CWHLSPDX
    1167 00004b90     09af          MMFM    SP,A0,A1,A6,A7,A8,A9,A11
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   27

         00004ba0     0bc3  
    1168 00004bb0     0960          RETS
    1169                    
    1170                    **************************************************************************
    1171                    *                                                                        *
    1172                    * CWHLSPDS - !SPECIAL! ADJUST A VEHICLES WHEEL ANIMATION SPEED           *
    1173                    *                    ACCORDING TO THE CURRENT X VELOCITY.                *
    1174                    *                    USE THIS WHEN CALLING FROM A SECONDARY PROCESS.     *
    1175                    * A8 = PTR TO DRIVER                                                     *
    1176                    * A10 = PTR TO VEHICLE MAIN                                              *
    1177                    * A14 = PTR TO VEHICLE PROCESS BLOCK                                     *
    1178                    *                                                                        *
    1179                    **************************************************************************
    1180 00004bc0           CWHLSPDS
    1181 00004bc0     098f          MMTM    SP,A0,A1,A6,A7,A8,A9,A11
         00004bd0     c3d0  
    1182 00004be0     b74b          MOVE    *A10(OXVEL),A11,L
         00004bf0     0040  
    1183 00004c00     ca04          JRZ     CWHLSPSA        
    1184 00004c10     2a0b          SRA     16,A11
    1185 00004c20     cb0d          JRNZ    CWHLSPS0
    1186 00004c30     102b          INC     A11                     ;FRACTIONAL ALWAYS DOES THIS
    1187 00004c40     c00b          JRUC    CWHLSPS0
    1188 00004c50           CWHLSPSA
    1189 00004c50                   SWAP    A13,A14
    1190 00004c80     0d3f          CALLR   CWHLSTOP                ;XVEL = 0, STOP THE WHEELS
         00004c90     fd68  
    1191 00004ca0                   SWAP    A13,A14
    1192 00004cd0     09af          MMFM    SP,A0,A1,A6,A7,A8,A9,A11
         00004ce0     0bc3  
    1193 00004cf0     0960          RETS
    1194                    
    1195 00004d00           CWHLSPS0
    1196 00004d00     b7c6          MOVE    *A14(EMAINT),A6,L
         00004d10     0100  
    1197 00004d20     09c1          MOVI    INDPID,A1       ;LOAD THESE PARAMS IN CASE WE MUST CREATE
         00004d30     0006  
    1198 00004d40     09e7          MOVI    ANIMATOR,A7     ;INDEPENDANT ANIMATION PROCESS
         00004d50 00000000! 
    1199 00004d70     038b          ABS     A11
    1200 00004d80     150b          SUBK    8,A11
    1201 00004d90     c401          JRLT    CWHLSPS1
    1202 00004da0     576b          CLR     A11
    1203 00004db0           CWHLSPS1
    1204 00004db0     038b          ABS     A11
    1205 00004dc0     b7c8          MOVE    *A14(ETEMP3),A8,L
         00004dd0     01c0  
    1206 00004de0     ca15          JRZ     CWSPS2A                 ;BR = NO FRONT WHEEL
    1207 00004df0     b700          MOVE    *A8(OPLINK),A0,L
         00004e00     01f0  
    1208 00004e10     ca04          JRZ     CWHLSPS2                ;BR = NO SPIN PROC
    1209 00004e20     0d5f          CALLA   PUTA11                  ;PUT THE TIME
         00004e30 00000000! 
    1210 00004e50     c00e          JRUC    CWSPS2A
    1211 00004e60           CWHLSPS2
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   28

    1212 00004e60     0d3f          CALLR   ISREVERS
         00004e70     00b7  
    1213 00004e80     c802          JRC     CWSPS1A
    1214 00004e90     1a60          MOVK    FRONTWHE,A0
    1215 00004ea0     c001          JRUC    CWSPS1B
    1216 00004eb0           CWSPS1A
    1217 00004eb0     1ba0          MOVK    FRONTWR,A0
    1218 00004ec0           CWSPS1B
    1219 00004ec0     0d5f          CALLA   GSCRIPT
         00004ed0 00000000! 
    1220 00004ef0     0d5f          CALLA   GETPRC                  ;START THE FRONT WHEEL SPIN PROC
         00004f00 00000000! 
    1221 00004f20     b208          MOVE    A0,*A8(OPLINK),L
         00004f30     01f0  
    1222 00004f40           CWSPS2A
    1223 00004f40     0d3f          CALLR   ISREVERS
         00004f50     00a9  
    1224 00004f60     c802          JRC     CWHLSPS4
    1225 00004f70     1a40          MOVK    REARWHEE,A0
    1226 00004f80     c001          JRUC    CWHLSPS5
    1227 00004f90           CWHLSPS4
    1228 00004f90     1b80          MOVK    REARWR,A0
    1229 00004fa0           CWHLSPS5
    1230 00004fa0     0d5f          CALLA   GSCRIPT
         00004fb0 00000000! 
    1231 00004fd0     b7c8          MOVE    *A14(ETEMP4),A8,L
         00004fe0     01e0  
    1232 00004ff0     ca0e          JRZ     CWSPS3A                 ;BR = NO REAR WHEEL
    1233 00005000     b700          MOVE    *A8(OPLINK),A0,L
         00005010     01f0  
    1234 00005020     ca06          JRZ     CWHLSPS3
    1235 00005030     0d3f          CALLR   ANIMATCH
         00005040     00ac  
    1236 00005050     0d5f          CALLA   PUTA11
         00005060 00000000! 
    1237 00005080     c005          JRUC    CWSPS3A
    1238 00005090           CWHLSPS3
    1239 00005090     0d5f          CALLA   GETPRC          ;REAR WHEEL SPIN PROC
         000050a0 00000000! 
    1240 000050c0     b208          MOVE    A0,*A8(OPLINK),L
         000050d0     01f0  
    1241 000050e0           CWSPS3A
    1242 000050e0           CWHLSPSX
    1243 000050e0     09af          MMFM    SP,A0,A1,A6,A7,A8,A9,A11
         000050f0     0bc3  
    1244 00005100     0960          RETS
    1245                    
    1246                    **************************************************************************
    1247                    *                                                                        *
    1248                    * DRIVERAN - PROCESS TOTAL DRIVER ANIMATION SCRIPT. QUITS IF THE         *
    1249                    *          GUY DIED. PROC BLOCK MUST BE INITIALIZED AS AN ENEMY.         *
    1250                    * A8 = PTR TO OBJ                                                        *
    1251                    * A9 = PTR TO SCRIPT                                                     *
    1252                    * RETURNS                                                                *
    1253                    * A9 = POINTING TO WORD AFTER SCRIPT                                     *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   29

    1254                    * CARRY CLEAR = DIED                                                     *
    1255                    * NOTE: CALL WITH JSRP                                                   *
    1256                    *                                                                        *
    1257                    **************************************************************************
    1258 00005110           DRIVERAN
    1259 00005110     5621          CLR     A1                                               
    1260 00005120                   JSRP    FRANIM                                                   
    1261 00005190     c805          JRC     DRVRANX                 ;BR = THE ANIMATION IS DONE
    1262                    
    1263 000051a0     b7a0          MOVE    *A13(EFLAGS),A0,L
         000051b0     0080  
    1264 000051c0     1de0          BTST    BDIE,A0
    1265 000051d0     caf3          JREQ    DRIVERAN                ;BR = HE'S STILL ALIVE
    1266 000051e0     0320          CLRC
    1267 000051f0           DRVRANX
    1268 000051f0                   RETP
    1269                    
    1270                    **************************************************************************
    1271                    *                                                                        *
    1272                    * CZRESET - RESET ALL VEHICLE PART Z POSITIONS TO MATCH THE MAIN         *
    1273                    *         BODY.                                                          *
    1274                    * A8 = PTR TO DRIVER                                                     *
    1275                    * A10 = PTR TO CAR                                                       *
    1276                    *                                                                        *
    1277                    **************************************************************************
    1278 00005220           CZRESET
    1279 00005220     098f          MMTM    SP,A0,A11
         00005230     8010  
    1280 00005240     b74b          MOVE    *A10(OZVAL),A11,L       ;GET THE CURRENT CAR Z VALUE
         00005250     00c0  
    1281 00005260     142b          DEC     A11     
    1282 00005270     b7a0          MOVE    *A13(ETEMP3),A0,L
         00005280     01c0  
    1283 00005290     ca02          JRZ     CZRESET1
    1284 000052a0     b360          MOVE    A11,*A0(OZVAL),L        ;FRONT WHEEL = CAR Z - 1
         000052b0     00c0  
    1285 000052c0           CZRESET1
    1286 000052c0     b7a0          MOVE    *A13(ETEMP4),A0,L
         000052d0     01e0  
    1287 000052e0     ca02          JRZ     CZRESET2
    1288 000052f0     b360          MOVE    A11,*A0(OZVAL),L        ;REAR WHEEL = CAR Z - 1
         00005300     00c0  
    1289 00005310           CZRESET2
    1290 00005310     106b          ADDK    3,A11
    1291 00005320     b7a0          MOVE    *A13(ETEMP2),A0,L
         00005330     01a0  
    1292 00005340     ca02          JRZ     CZRESET3
    1293 00005350     b360          MOVE    A11,*A0(OZVAL),L        ;TRUNK = CAR Z + 2
         00005360     00c0  
    1294 00005370           CZRESET3
    1295 00005370     b7a0          MOVE    *A13(ETEMP1),A0,L
         00005380     0180  
    1296 00005390     ca02          JRZ     CZRESET5
    1297 000053a0     b360          MOVE    A11,*A0(OZVAL),L        ;WINDSHEILD = CAR Z + 2
         000053b0     00c0  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   30

    1298 000053c0           CZRESET5
    1299 000053c0     142b          DEC     A11
    1300 000053d0     b7a0          MOVE    *A13(ETEMP5),A0,L
         000053e0     0200  
    1301 000053f0     ca02          JRZ     CZRESET6
    1302 00005400     b360          MOVE    A11,*A0(OZVAL),L        ;ETEMP5 = CAR Z + 1
         00005410     00c0  
    1303 00005420           CZRESET6
    1304 00005420     b7a0          MOVE    *A13(ETEMP6),A0,L
         00005430     0220  
    1305 00005440     ca02          JRZ     CZRESET7
    1306 00005450     b360          MOVE    A11,*A0(OZVAL),L        ;ETEMP6 = CAR Z + 1
         00005460     00c0  
    1307 00005470           CZRESET7
    1308 00005470     b7a0          MOVE    *A13(ETEMP7),A0,L
         00005480     0240  
    1309 00005490     ca02          JRZ     CZRESET8
    1310 000054a0     b360          MOVE    A11,*A0(OZVAL),L        ;ETEMP7 = CAR Z + 1
         000054b0     00c0  
    1311 000054c0           CZRESET8
    1312 000054c0     b7a0          MOVE    *A13(ETEMP8),A0,L
         000054d0     0260  
    1313 000054e0     ca02          JRZ     CZRESETD
    1314 000054f0     b360          MOVE    A11,*A0(OZVAL),L        ;ETEMP8 = CAR Z + 1
         00005500     00c0  
    1315 00005510           CZRESETD
    1316 00005510     4d08          MOVE    A8,A8
    1317 00005520     ca02          JRZ     CZRESETX
    1318 00005530     b368          MOVE    A11,*A8(OZVAL),L        ;DRIVER = CAR Z + 1
         00005540     00c0  
    1319 00005550           CZRESETX
    1320 00005550     09af          MMFM    SP,A0,A11
         00005560     0801  
    1321 00005570     0960          RETS
    1322                    
    1323                    **************************************************************************
    1324                    *                                                                        *
    1325                    * CARSETZ - SET Z POSITION OF VEHICLE ACCORDING TO THE REAR WHEEL,       *
    1326                    *               THEN RESET THE REST TO MATCH THAT BAD DOG.               *
    1327                    * A8 = PTR TO DRIVER                                                     *
    1328                    * A10 = PTR TO VEHICLE                                                   *
    1329                    * A13 = PTR TO PROC BLOC                                                 *
    1330                    *                                                                        *
    1331                    **************************************************************************
    1332 00005580           CARSETZ
    1333 00005580                   PUSH    A0
    1334 00005590     b7a0          MOVE    *A13(ETEMP4),A0,L       
         000055a0     01e0  
    1335 000055b0     0d5f          CALLA   SETZPOS
         000055c0 00000000! 
    1336 000055e0     ba0a          MOVE    *A0(OZVAL),*A10(OZVAL),L
         000055f0     00c0  
         00005600     00c0  
    1337 00005610     09af          MMFM    SP,A0
         00005620     0001  
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   31

    1338 00005630     c0be          JRUC    CZRESET
    1339                    
    1340                    **************************************************************************
    1341                    *                                                                        *
    1342                    * CARADDY - ADD THIS AMOUNT TO THE Y VALUE OF ALL VEHICLE PARTS.         *
    1343                    * A1 = AMOUNT TO ADD 32 BITS                                             *
    1344                    * A8 = PTR TO DRIVER                                                     *
    1345                    * A10 = PTR TO CAR                                                       *
    1346                    *                                                                        *
    1347                    **************************************************************************
    1348 00005640           CARADDY
    1349 00005640     098f          MMTM    SP,A0,A6,A11,A14
         00005650     8212  
    1350 00005660     b74b          MOVE    *A10(OYVAL),A11,L       ;GET THE CURRENT CAR Y VALUE
         00005670     00a0  
    1351 00005680     402b          ADD     A1,A11
    1352 00005690     b36a          MOVE    A11,*A10(OYVAL),L
         000056a0     00a0  
    1353 000056b0     4d00          MOVE    A8,A0
    1354 000056c0     ca05          JRZ     CARYM1
    1355 000056d0     b60b          MOVE    *A0(OYVAL),A11,L
         000056e0     00a0  
    1356 000056f0     402b          ADD     A1,A11
    1357 00005700     b360          MOVE    A11,*A0(OYVAL),L
         00005710     00a0  
    1358 00005720           CARYM1
    1359 00005720     1906          MOVK    NPARTS,A6       
    1360 00005730     4dae          MOVE    A13,A14
    1361 00005740     0b0e          ADDI    ETEMP1,A14
         00005750     0180  
    1362 00005760           CARYM2
    1363 00005760     97c0          MOVE    *A14+,A0,L
    1364 00005770     ca05          JRZ     CARYM3
    1365 00005780     b60b          MOVE    *A0(OYVAL),A11,L
         00005790     00a0  
    1366 000057a0     402b          ADD     A1,A11
    1367 000057b0     b360          MOVE    A11,*A0(OYVAL),L
         000057c0     00a0  
    1368 000057d0           CARYM3
    1369 000057d0     3d06          DSJS    A6,CARYM2
    1370 000057e0     09af          MMFM    SP,A0,A6,A11,A14
         000057f0     4841  
    1371 00005800     0960          RETS
    1372                    
    1373                    **************************************************************************
    1374                    *                                                                        *
    1375                    * CARSCRTST - TEST TO SEE IF A VEHICLE IS TOTALLY OFF THE SCREEN.        *
    1376                    * A8 = PTR TO DRIVER/PILOT/RANCHERO                                      *
    1377                    * A10 = PTR TO VEHICLE                                                   *
    1378                    * A13 = PTR TO LOADED PROC BLOC                                          *
    1379                    * RETURNS:                                                               *
    1380                    * Z BIT CLR = ALL OFF SCREEN                                             *
    1381                    * Z BIT SET = ALL/PART ON SCREEN                                         *
    1382                    *                                                                        *
    1383                    **************************************************************************
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   32

    1384 00005810           CARSCRTST
    1385 00005810     098f          MMTM    SP,A6,A8,A14
         00005820     0282  
    1386 00005830     4d08          MOVE    A8,A8
    1387 00005840     ca04          JRZ     CSTST1          ;BR = NO DRIVER
    1388 00005850     0d5f          CALLA   SCRTST
         00005860 00000000! 
    1389 00005880     ca13          JRZ     CSTSTX          ;BR = THIS GUYS ON SCREEN
    1390 00005890           CSTST1
    1391 00005890     4d48          MOVE    A10,A8
    1392 000058a0     ca04          JRZ     CSTST2          ;BR = NO VEHICLE?
    1393 000058b0     0d5f          CALLA   SCRTST
         000058c0 00000000! 
    1394 000058e0     ca0d          JRZ     CSTSTX          ;BR = ON SCREEN
    1395 000058f0           CSTST2
    1396 000058f0     1906          MOVK    NPARTS,A6       ;TEST 'DEM PARTS
    1397 00005900     4dae          MOVE    A13,A14
    1398 00005910     0b0e          ADDI    ETEMP1,A14
         00005920     0180  
    1399 00005930           CSTST3
    1400 00005930     97c8          MOVE    *A14+,A8,L
    1401 00005940     ca04          JRZ     CSTST4
    1402 00005950     0d5f          CALLA   SCRTST
         00005960 00000000! 
    1403 00005980     ca03          JRZ     CSTSTX
    1404 00005990           CSTST4
    1405 00005990     3ce6          DSJ     A6,CSTST3
    1406 000059a0     09c6          MOVI    1,A6            ;CLEAR THE Z BIT
         000059b0     0001  
    1407 000059c0           CSTSTX
    1408 000059c0     09af          MMFM    SP,A6,A8,A14
         000059d0     4140  
    1409 000059e0     0960          RETS
    1410                    
    1411                    **************************************************************************
    1412                    *                                                                        *
    1413                    * ISREVERS - DETERMINE IF A CAR IS TRAVELING IN REVERSE                  *
    1414                    * A10 = PTR TO CAR                                                       *
    1415                    * RETURNS:                                                               *
    1416                    *       CARRY CLR = FORWARD                                              *
    1417                    *       CARRY SET = REVERSE                                              *
    1418                    *                                                                        *
    1419                    **************************************************************************
    1420 000059f0           ISREVERS
    1421 000059f0     098f          MMTM    SP,A0,A4
         00005a00     8800  
    1422 00005a10     b544          MOVE    *A10(OFLAGS),A4,W
         00005a20     0100  
    1423 00005a30     b740          MOVE    *A10(OXVEL),A0,L
         00005a40     0040  
    1424 00005a50     ca03          JRZ     ISREVCLR                ;NOT TRAVELING, DEFAULT IS FORWARD
    1425 00005a60     ce04          JRN     ISREV1
    1426 00005a70     1f64          BTST    B_FLIPH,A4
    1427 00005a80     cb04          JRNE    ISREVSET
    1428 00005a90           ISREVCLR
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   33

    1429 00005a90     0320          CLRC
    1430 00005aa0     c003          JRUC    ISREVX
    1431 00005ab0           ISREV1
    1432 00005ab0     1f64          BTST    B_FLIPH,A4      
    1433 00005ac0     cbfc          JRNE    ISREVCLR
    1434 00005ad0           ISREVSET
    1435 00005ad0     0de0          SETC
    1436 00005ae0           ISREVX
    1437 00005ae0     09af          MMFM    SP,A0,A4
         00005af0     0011  
    1438 00005b00     0960          RETS
    1439                    **************************************************************************
    1440                    *                                                                        *
    1441                    * ANIMATCH - ANIMATOR LOOP MATCH. TAKES A CURRENT ANIMATOR PROCESS       *
    1442                    *          AND ATTEMPTS TO STICK A NEW SCRIPT IN. IT WILL MATCH          *
    1443                    *          THE FRAME #'S FOR SIMILAIR ANIMATIONS.                        *
    1444                    * A0 = PTR TO ANIMATOR PROCESS                                           *
    1445                    * A9 = NEW ANIMATION SCRIPT                                              *
    1446                    * RETURNS                                                                *
    1447                    * Z BIT SET = NO NEED TO CHANGE, CORRECT LIST IS IN PLACE                *
    1448                    * Z BIT CLR = A9 IS THE PTR TO MATCHING ANIMATION FRAME                  *
    1449                    *                                                                        *
    1450                    **************************************************************************
    1451 00005b10           ANIMATCH
    1452 00005b10     098f          MMTM    SP,A1,A2,A3
         00005b20     7000  
    1453 00005b30     b601          MOVE    *A0(PSPTR),A1,L
         00005b40     0040  
    1454 00005b50     0b01          ADDI    0A0H,A1
         00005b60     00a0  
    1455 00005b70     8622          MOVE    *A1,A2,L                ;GET THE SCRIPT LOOP POINT
    1456 00005b80     4849          CMP     A2,A9
    1457 00005b90     ca0d          JREQ    ANIMATX
    1458 00005ba0     4d23          MOVE    A9,A3
    1459 00005bb0     0d5f          CALLA   GETA9
         00005bc0 00000000! 
    1460 00005be0     4449          SUB     A2,A9                   ;FROM AN OFFSET
    1461 00005bf0     4d22          MOVE    A9,A2
    1462 00005c00     4c69          MOVE    A3,A9
    1463 00005c10     8321          MOVE    A9,*A1,L                ;RE-STUFF AS LOOP POINT
    1464 00005c20     4049          ADD     A2,A9                   ;OFFSET RIGHT INTO THAT SUCKER
    1465 00005c30     0d5f          CALLA   PUTA9
         00005c40 00000000! 
    1466 00005c60     4d29          MOVE    A9,A9                   ;CLEAR Z BIT
    1467 00005c70           ANIMATX
    1468 00005c70     09af          MMFM    SP,A1,A2,A3
         00005c80     000e  
    1469 00005c90     0960          RETS
    1470                    **************************************************************************
    1471                    *                                                                        *
    1472                    * FINDMVP - FIND YOUR MASTER VEHICLE PROCESS,                            *
    1473                    *          IF YOUR'RE PART OF A VEHICLE CONTAINED IN THE ETEMP1-6 AREA.  *
    1474                    * A0 = OBJECT PTR.                                                       *
    1475                    * RETURNS:                                                               *
    1476                    *       Z BIT SET = NO MATCH WAS FOUND, A0 = 0                           *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   34

    1477                    *       Z BIT CLR = MATCH FOUND, A0 = PTR TO PROCESS                     *
    1478                    *                                                                        *
    1479                    **************************************************************************
    1480 00005ca0           FINDMVP
    1481 00005ca0     098f          MMTM    SP,A1,A2,A3,A6,A14
         00005cb0     7202  
    1482 00005cc0     4c01          MOVE    A0,A1
    1483 00005cd0     09c3          MOVI    CADEPID,A3
         00005ce0     0cd0  
    1484 00005cf0     2f83          SRL     4,A3                    ;WE'RE ONLY CONCERNED WITH THESE
    1485 00005d00     09e0          MOVI    ACTIVE,A0               ;GET THE PROCESS LIST
         00005d10 00000000! 
    1486 00005d30           FINDMVPL
    1487 00005d30     8600          MOVE    *A0,A0,L
    1488 00005d40     ca0f          JRZ     FINDMVPX                ;BR = WE'RE DONE
    1489 00005d50     b402          MOVE    *A0(PROCID),A2,W
         00005d60     0020  
    1490 00005d70     2f82          SRL     4,A2
    1491 00005d80     4862          CMP     A3,A2
    1492 00005d90     cbf9          JRNE    FINDMVPL                ;BR = NOT A MASTER VEHICLE PROCESS
    1493 00005da0     1906          MOVK    NPARTS,A6               ;CHECK ALL THE ETEMP AREAS
    1494 00005db0     4c0e          MOVE    A0,A14
    1495 00005dc0     0b0e          ADDI    ETEMP1,A14
         00005dd0     0180  
    1496 00005de0           FINDMVP2
    1497 00005de0     97c2          MOVE    *A14+,A2,L      
    1498 00005df0     4841          CMP     A2,A1
    1499 00005e00     ca02          JREQ    FINDMVPF
    1500 00005e10     3c86          DSJS    A6,FINDMVP2
    1501 00005e20     c0f0          JRUC    FINDMVPL
    1502 00005e30           FINDMVPF
    1503 00005e30     4c00          MOVE    A0,A0                   ;CLR Z FLAG
    1504 00005e40           FINDMVPX
    1505 00005e40     09af          MMFM    SP,A1,A2,A3,A6,A14
         00005e50     404e  
    1506 00005e60     0960          RETS
    1507                    
    1508                    **************************************************************************
    1509                    *                                                                        *
    1510                    * CSHADST - VEHICLE SHADOW START, FUDGED FOR CARS                        *
    1511                    * A10 = PTR TO VEHICLE                                                   *
    1512                    * RETURNS:                                                               *
    1513                    * A0 = SHADOW, 0 IF NO SHADOW WAS CREATED                                *
    1514                    *       Z BIT REFELCTS A0                                                *
    1515                    *                                                                        *
    1516                    **************************************************************************
    1517 00005e70           CSHADST
    1518 00005e70     0960          RETS                    ;SHADOWS HAVE BEEN CANNED
    1519 00005e80     098f          MMTM    SP,A1,A2
         00005e90     6000  
    1520 00005ea0                   SWAP    A10,A8                  ;START SHADOW ON MAIN BODY
    1521 00005ed0     0d5f          CALLA   SHADST
         00005ee0 00000000! 
    1522 00005f00     0d5f          CALLA   DFRMGRND                ;Z IS SET ACCORDING TO WHEELS BY NOW
         00005f10 00000000! 
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   35

    1523 00005f30                   SWAP    A10,A8
    1524 00005f60     4c00          MOVE    A0,A0
    1525 00005f70     ca06          JRZ     CSHADSTX        
    1526 00005f80     b402          MOVE    *A0(OYPOS),A2,W
         00005f90     00b0  
    1527 00005fa0     4422          SUB     A1,A2                   ;FUDGE THE Y POSITION
    1528 00005fb0     b040          MOVE    A2,*A0(OYPOS),W
         00005fc0     00b0  
    1529 00005fd0     4c00          MOVE    A0,A0
    1530 00005fe0           CSHADSTX
    1531 00005fe0     09af          MMFM    SP,A1,A2
         00005ff0     0006  
    1532 00006000     0960          RETS
    1533                    
    1534                    **************************************************************************
    1535                    *                                                                        *
    1536                    * CRESET - POSITION ALL PARTS WITH RESPECT TO THE MAIN ANIMATION POINT.  *
    1537                    * A8 = PTR TO DRIVER                                                     *
    1538                    * A10 = PTR TO CAR                                                       *
    1539                    * A13 = PTR TO CAR PROCESS                                               *
    1540                    * ETEMP1-8 = PART POINTERS                                               *
    1541                    *                                                                        *
    1542                    **************************************************************************
    1543 00006010           CRESET
    1544 00006010     098f          MMTM    SP,A0,A1,A2,A3,A4,A5,A6,A7,A14
         00006020     ff02  
    1545 00006030     099f          MMTM    SP,B0,B1,B2
         00006040     e000  
    1546 00006050     b741          MOVE    *A10(OIMG),A1,L
         00006060     0180  
    1547 00006070     b742          MOVE    *A10(OSIZE),A2,L
         00006080     0140  
    1548 00006090     b544          MOVE    *A10(OFLAGS),A4,W
         000060a0     0100  
    1549 000060b0     0d5f          CALLA   GANIOF                          ;GET THE CAR ANIMATION PNT.
         000060c0 00000000! 
    1550 000060e0     b743          MOVE    *A10(OXVAL),A3,L
         000060f0     0080  
    1551 00006100     b745          MOVE    *A10(OYVAL),A5,L
         00006110     00a0  
    1552 00006120     40c3          ADD     A6,A3
    1553 00006130     40e5          ADD     A7,A5                           ;SET THE PRECEDENT
    1554                    
    1555 00006140     4e60          MOVE    A3,B0
    1556 00006150     4ea1          MOVE    A5,B1                           ;COPY HERE FOR PROCESSING
    1557 00006160     4d08          MOVE    A8,A8
    1558 00006170     ca0f          JRZ     CRESET1                         ;BR = NO DRIVER
    1559 00006180     b701          MOVE    *A8(OIMG),A1,L
         00006190     0180  
    1560 000061a0     b702          MOVE    *A8(OSIZE),A2,L
         000061b0     0140  
    1561 000061c0     b504          MOVE    *A8(OFLAGS),A4,W
         000061d0     0100  
    1562 000061e0     0d5f          CALLA   GANIOF
         000061f0 00000000! 
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   36

    1563 00006210     44c3          SUB     A6,A3   
    1564 00006220     44e5          SUB     A7,A5
    1565 00006230     b268          MOVE    A3,*A8(OXVAL),L
         00006240     0080  
    1566 00006250     b2a8          MOVE    A5,*A8(OYVAL),L                 ;STUFF NEW DRIVER COORDS.
         00006260     00a0  
    1567 00006270           CRESET1
    1568 00006270     4dae          MOVE    A13,A14
    1569 00006280     0b0e          ADDI    ETEMP1,A14                      ;GO FOR THE PARTS
         00006290     0180  
    1570 000062a0     1912          MOVK    NPARTS,B2                       ;ALL SIX OF THEM                
    1571 000062b0           CRESET2
    1572 000062b0     97c0          MOVE    *A14+,A0,L                      ;GET A NEW PART
    1573 000062c0     ca11          JRZ     CRESET3                         ;BR = NO PART TO BE FOUND
    1574 000062d0     b601          MOVE    *A0(OIMG),A1,L
         000062e0     0180  
    1575 000062f0     b602          MOVE    *A0(OSIZE),A2,L
         00006300     0140  
    1576 00006310     b404          MOVE    *A0(OFLAGS),A4,W
         00006320     0100  
    1577 00006330     0d5f          CALLA   GANIOF
         00006340 00000000! 
    1578 00006360     4e13          MOVE    B0,A3
    1579 00006370     4e35          MOVE    B1,A5                           ;RESTORE REFERENCE PNT.
    1580 00006380     44c3          SUB     A6,A3   
    1581 00006390     44e5          SUB     A7,A5
    1582 000063a0     b260          MOVE    A3,*A0(OXVAL),L
         000063b0     0080  
    1583 000063c0     b2a0          MOVE    A5,*A0(OYVAL),L                 ;STUFF NEW PART COORDS.
         000063d0     00a0  
    1584 000063e0           CRESET3
    1585 000063e0     3e92          DSJS    B2,CRESET2
    1586 000063f0     b740          MOVE    *A10(OSHAD),A0,L
         00006400     0240  
    1587 00006410     ca06          JRZ     CRESET4                         ;BR = NO SHADOW TO RESET
    1588 00006420     4d40          MOVE    A10,A0
    1589 00006430     0d5f          CALLA   DELSHAD
         00006440 00000000! 
    1590 00006460     0d3f          CALLR   CSHADST                         ;RESET THE SHADOW
         00006470     ff9f  
    1591 00006480           CRESET4
    1592 00006480     09bf          MMFM    SP,B0,B1,B2
         00006490     0007  
    1593 000064a0     09af          MMFM    SP,A0,A1,A2,A3,A4,A5,A6,A7,A14
         000064b0     40ff  
    1594 000064c0     0960          RETS
    1595                    
    1596                    
    1597                    **************************************************************************
    1598                    *                                                                        *
    1599                    * CFRAGGED - CHECK TO SEE IF THE CAR AND IT'S CONSTITUENTS ARE NOT       *
    1600                    *               TOGETHER.                                                *
    1601                    * A8 = PTR TO DRIVER                                                     *
    1602                    * A10 = PTR TO CAR                                                       *
    1603                    * A13 = PTR TO CAR PROCESS                                               *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   37

    1604                    * ETEMP1-8 = PART POINTERS                                               *
    1605                    * RETURNS:                                                               *
    1606                    *       NE = FRAGMENTED (SHOULD RESET AS SOON AS POSSIBLE)               *
    1607                    *       EQ = ALL TOGETHER (DON'T FUCK WITH IT, IT'S NOT BROKEN.)         *
    1608                    *                                                                        *
    1609                    **************************************************************************
    1610 000064d0           CFRAGGED
    1611 000064d0     098f          MMTM    SP,A2,A3,A4,A5,A6,A8,A14
         000064e0     3e82  
    1612 000064f0                   SWAP    A10,A8
    1613 00006520     0d5f          CALLA   GETANIXY
         00006530 00000000! 
    1614 00006550                   SWAP    A10,A8
    1615 00006580     4c44          MOVE    A2,A4
    1616 00006590     4c65          MOVE    A3,A5                           ;SET A PRECEDENT
    1617                    
    1618 000065a0     4d08          MOVE    A8,A8
    1619 000065b0     ca07          JRZ     CFRAGGED1                       ;BR = NO DRIVER
    1620 000065c0     0d5f          CALLA   GETANIXY
         000065d0 00000000! 
    1621 000065f0     4844          CMP     A2,A4
    1622 00006600     cb11          JRNE    CFRAGGEDX
    1623 00006610     4865          CMP     A3,A5
    1624 00006620     cb0f          JRNE    CFRAGGEDX
    1625 00006630           CFRAGGED1
    1626 00006630     4dae          MOVE    A13,A14
    1627 00006640     0b0e          ADDI    ETEMP1,A14                      ;GO FOR THE PARTS
         00006650     0180  
    1628 00006660     1906          MOVK    NPARTS,A6                       ;ALL SIX OF THEM                
    1629 00006670           CFRAGGED2
    1630 00006670     97c8          MOVE    *A14+,A8,L                      ;GET A NEW PART
    1631 00006680     ca07          JRZ     CFRAGGED3                       ;BR = NO PART TO BE FOUND
    1632 00006690     0d5f          CALLA   GETANIXY
         000066a0 00000000! 
    1633 000066c0     4844          CMP     A2,A4
    1634 000066d0     cb04          JRNE    CFRAGGEDX
    1635 000066e0     4865          CMP     A3,A5
    1636 000066f0     cb02          JRNE    CFRAGGEDX
    1637 00006700           CFRAGGED3
    1638 00006700     3d46          DSJS    A6,CFRAGGED2
    1639 00006710     56c6          CLR     A6                              ;SET Z BIT 
    1640 00006720           CFRAGGEDX
    1641 00006720     09af          MMFM    SP,A2,A3,A4,A5,A6,A8,A14
         00006730     417c  
    1642 00006740     0960          RETS
    1643                    
    1644                    **************************************************************************
    1645                    *                                                                        *
    1646                    * CKCRESET - CHECK TO SEE IF IT'S TIME TO RESET, VIA THE TIMER STORED    *
    1647                    *          IN ERESET.                                                    *
    1648                    * A8 = PTR TO DRIVER                                                     *
    1649                    * A10 = PTR TO CAR                                                       *
    1650                    * A13 = PTR TO CAR PROCESS                                               *
    1651                    * ETEMP1-8 = PART POINTERS                                               *
    1652                    *                                                                        *
TMS340 COFF Macro Assembler Version 6.10     Sat Apr 10 02:18:59 2021
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

 <<< N  A  R  C  -- VEHICLE SUBROUTINES >>>                          PAGE   38

    1653                    **************************************************************************
    1654 00006750           CKCRESET
    1655 00006750                   PUSH    A0
    1656 00006760     b5a0          MOVE    *A13(ERESET),A0,W       ;GET TIME 'TIL NEXT RESET
         00006770     0120  
    1657 00006780     0b40          CMPI    3CH,A0                  ;IS IT TIME?
         00006790     ffc3  
    1658 000067a0     c806          JRLO    CKNORST                 ;BR = NO, IT'S NOT.
    1659 000067b0     0d3f          CALLR   CFRAGGED
         000067c0     ffd0  
    1660 000067d0     ca02          JREQ    CKNOFRAGS               ;NOT FRAGMENTED, DON'T RESET IT
    1661 000067e0     0d3f          CALLR   CRESET
         000067f0     ff81  
    1662 00006800           CKNOFRAGS
    1663 00006800     5600          CLR     A0
    1664 00006810           CKNORST
    1665 00006810     1020          INC     A0                      ;KICK IT
    1666 00006820     b00d          MOVE    A0,*A13(ERESET),W
         00006830     0120  
    1667 00006840                   PULL    A0
    1668 00006860     0960          RETS
    1669                    
    1670                    **************************************************************************
    1671                    *                                                                        *
    1672                    * SINKCARC - SINK THE VEHICLE CARCASS INTO THE GROUND                    *
    1673                    * A8 = PTR TO VEHICLE CARCASS                                            *
    1674                    *                                                                        *
    1675                    **************************************************************************
    1676 00006870           SINKCARC
    1677 00006870                   SLEEP   10
    1678 000068b0     09e9          MOVI    [1,1],A9
         000068c0 00010001  
    1679 000068e0                   JSRP    OSINK
    1680 00006950     4d0a          MOVE    A8,A10                  ;GET OBJECT DESCRIPTOR
    1681 00006960     0d3f          CALLR   DELCBODY                ;DELETE CAR BODY OBJECT AND QUIT
         00006970     fa82  
    1682 00006980                   DIE
    1683                    
    1684                            .END

 No Errors,  No Warnings
